

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>5.1. Elliptic PDEs &#8212; Mechanical Engineering Methods</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"TeX": {"Macros": {"vector": ["\\vec{#1}", 1], "uvec": ["\\hat{#1}", 1], "mag": ["\\lVert#1\\rVert", 1], "cross": "\\times", "unit": ["#1~\\mathrm{#2}", 2]}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/pdes/elliptic';</script>
    <link rel="canonical" href="https://kyleniemeyer.github.io/ME373-book/content/pdes/elliptic.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="5.2. Parabolic PDEs" href="parabolic.html" />
    <link rel="prev" title="5. Partial Differential Equations" href="partial-differential-equations.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    <p class="title logo__title">Mechanical Engineering Methods</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Mechanical Engineering Methods
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Ordinary Differential Equations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../first-order.html">1. Solutions to 1st-order ODEs</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../numerical-methods/numerical-methods.html">2. Numerical Methods</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../numerical-methods/integrals.html">2.1. Numerical integrals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../numerical-methods/error.html">2.2. Error</a></li>
<li class="toctree-l2"><a class="reference internal" href="../numerical-methods/initial-value-methods.html">2.3. Numerical Solutions of 1st-order ODEs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../numerical-methods/stability.html">2.4. Stability and Stiffness</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../second-order/second-order.html">3. Second-order Ordinary Differential Equations</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../second-order/analytical.html">3.1. Analytical Solutions to 2nd-order ODEs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-order/initial-value-problems.html">3.2. Initial-Value Problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-order/numerical-methods.html">3.3. Numerical methods for 2nd-order ODEs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-order/fourier-series.html">3.4. Fourier Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-order/power-series.html">3.5. Power Series Solutions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../bvps/boundary-value-problems.html">4. Boundary Value Problems</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../bvps/shooting-method.html">4.1. Shooting Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bvps/finite-difference.html">4.2. Finite difference method</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bvps/eigenvalue.html">4.3. Eigenvalue problems</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Partial Differential Equations</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="partial-differential-equations.html">5. Partial Differential Equations</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">5.1. Elliptic PDEs</a></li>
<li class="toctree-l2"><a class="reference internal" href="parabolic.html">5.2. Parabolic PDEs</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Sample Quizzes</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../quizzes/quiz2-IVPs.html">Sample Quiz 2 problems: IVPs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quizzes/quiz3-BVPs.html">Sample Quiz 3 problems: BVPs</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">About</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://github.com/kyleniemeyer/ME373-book">GitHub repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing to Jupyter Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zbibliography.html">Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/kyleniemeyer/ME373-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/kyleniemeyer/ME373-book/edit/master/book/content/pdes/elliptic.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/kyleniemeyer/ME373-book/issues/new?title=Issue%20on%20page%20%2Fcontent/pdes/elliptic.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/content/pdes/elliptic.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Elliptic PDEs</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-heat-transfer-in-a-square-plate">5.1.1. Example: heat transfer in a square plate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#row-major-mapping">5.1.2. Row-major mapping</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-heat-transfer-in-a-square-plate-redux">5.1.3. Example: heat transfer in a square plate (redux)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#neumann-derivative-boundary-conditions">5.1.4. Neumann (derivative) boundary conditions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#iterative-solutions-for-very-large-problems">5.1.5. Iterative solutions for (very) large problems</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#jacobi-method">5.1.5.1. Jacobi method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gauss-seidel-method">5.1.5.2. Gauss-Seidel method</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="elliptic-pdes">
<h1><span class="section-number">5.1. </span>Elliptic PDEs<a class="headerlink" href="#elliptic-pdes" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries for numerical functions and plotting</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># these lines are only for helping improve the display</span>
<span class="kn">import</span> <span class="nn">matplotlib_inline.backend_inline</span>
<span class="n">matplotlib_inline</span><span class="o">.</span><span class="n">backend_inline</span><span class="o">.</span><span class="n">set_matplotlib_formats</span><span class="p">(</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span><span class="o">=</span> <span class="mi">300</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>
</pre></div>
</div>
</div>
</div>
<p>The classic example of an elliptic PDE is <strong>Laplace’s equation</strong> (yep, the same Laplace that gave us the Laplace transform), which in two dimensions for a variable <span class="math notranslate nohighlight">\(u(x,y)\)</span> is</p>
<div class="amsmath math notranslate nohighlight" id="equation-507a90b8-c554-4927-83af-474136f9b094">
<span class="eqno">(5.2)<a class="headerlink" href="#equation-507a90b8-c554-4927-83af-474136f9b094" title="Permalink to this equation">#</a></span>\[\begin{equation}
\frac{\partial^2 u}{\partial x^2} + \frac{\partial^2 u}{\partial y^2} = \nabla^2 u = 0 \;,
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(\nabla\)</span> is del, or nabla, and represents the gradient operator: <span class="math notranslate nohighlight">\(\nabla = \frac{\partial}{\partial x} + \frac{\partial}{\partial y}\)</span>.</p>
<p>Laplace’s equation shows up in a number of physical problems, including heat transfer, fluid dynamics, and electrostatics. For example, the heat equation for conduction in two dimensions is</p>
<div class="amsmath math notranslate nohighlight" id="equation-47dcd7d1-41a7-4a8a-8774-5a9a6bc7619b">
<span class="eqno">(5.3)<a class="headerlink" href="#equation-47dcd7d1-41a7-4a8a-8774-5a9a6bc7619b" title="Permalink to this equation">#</a></span>\[\begin{equation}
\frac{\partial u}{\partial t} = \alpha \left( \frac{\partial^2 u}{\partial x^2} + \frac{\partial^2 u}{\partial y^2} \right) \;,
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(u(x,y,t)\)</span> is temperature and <span class="math notranslate nohighlight">\(\alpha\)</span> is thermal diffusivity. Steady-state heat transfer (meaning after any initial transient period) is then described by Laplace’s equation.</p>
<p>A related elliptic PDE is <strong>Poisson’s equation</strong>:</p>
<div class="amsmath math notranslate nohighlight" id="equation-e82776ab-8020-466c-84aa-f4bd6462135d">
<span class="eqno">(5.4)<a class="headerlink" href="#equation-e82776ab-8020-466c-84aa-f4bd6462135d" title="Permalink to this equation">#</a></span>\[\begin{equation}
\nabla^2 u = f(x,y) \;,
\end{equation}\]</div>
<p>which also appears in multiple physical problems—most notably, when solving for pressure in the Navier–Stokes equations.</p>
<p>To numerically solve these equations, and any elliptic PDE, we can use finite differences, where we replace the continuous <span class="math notranslate nohighlight">\(x,y\)</span> domain with a discrete grid of points. This is similar to what we did with boundary-value problems in one dimension—but now we have two dimensions.</p>
<p>To approximate the second derivatives in Laplace’s equation, we can use central differences in both the <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> directions, applied around the <span class="math notranslate nohighlight">\(u_{i,j}\)</span> point:</p>
<div class="amsmath math notranslate nohighlight" id="equation-6f99b17a-a9a4-4444-b041-e2e745f30a8c">
<span class="eqno">(5.5)<a class="headerlink" href="#equation-6f99b17a-a9a4-4444-b041-e2e745f30a8c" title="Permalink to this equation">#</a></span>\[\begin{align}
\frac{\partial^2 u}{\partial x^2} &amp;\approx \frac{u_{i-1,j} - 2u_{i,j} + u_{i+1,j}}{\Delta x^2} \\
\frac{\partial^2 u}{\partial y^2} &amp;\approx \frac{u_{i,j-1} - 2u_{i,j} + u_{i,j+1}}{\Delta y^2}
\end{align}\]</div>
<p>where <span class="math notranslate nohighlight">\(i\)</span> is the index used in the <span class="math notranslate nohighlight">\(x\)</span> direction, <span class="math notranslate nohighlight">\(j\)</span> is the index in the <span class="math notranslate nohighlight">\(y\)</span> direction, and <span class="math notranslate nohighlight">\(\Delta x\)</span> and <span class="math notranslate nohighlight">\(\Delta y\)</span> are the step sizes in the <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> directions.
In other words, <span class="math notranslate nohighlight">\(x_i = (i-1) \Delta x\)</span> and <span class="math notranslate nohighlight">\(y_j = (j-1) \Delta y\)</span>.</p>
<p>The following figure shows the points necessary to approximate the partial derivatives in the PDE at a location <span class="math notranslate nohighlight">\((x_i, y_j)\)</span>, for a general 2D region. This is known as a <strong>five-point stencil</strong>:</p>
<figure class="align-default" id="fig-stencil">
<a class="bg-primary mb-1 reference internal image-reference" href="../../_images/five-point-stencil.png"><img alt="five-point stencil" class="bg-primary mb-1" src="../../_images/five-point-stencil.png" style="width: 350px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 5.1 </span><span class="caption-text">Five-point finite difference stencil</span><a class="headerlink" href="#fig-stencil" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Applying these finite differences gives us an approximation for Laplace’s equation:</p>
<div class="amsmath math notranslate nohighlight" id="equation-9e537f55-38ff-4fa2-a515-7d2d7a34d40c">
<span class="eqno">(5.6)<a class="headerlink" href="#equation-9e537f55-38ff-4fa2-a515-7d2d7a34d40c" title="Permalink to this equation">#</a></span>\[\begin{equation}
\frac{u_{i-1,j} - 2u_{i,j} + u_{i+1,j}}{\Delta x^2} + \frac{u_{i,j-1} - 2u_{i,j} + u_{i,j+1}}{\Delta y^2} = 0 \;.
\end{equation}\]</div>
<p>If we use a uniform grid where <span class="math notranslate nohighlight">\(\Delta x = \Delta y = h\)</span>, then we can simplify to</p>
<div class="amsmath math notranslate nohighlight" id="equation-e292c0b9-3c09-4388-a423-a6d976598e43">
<span class="eqno">(5.7)<a class="headerlink" href="#equation-e292c0b9-3c09-4388-a423-a6d976598e43" title="Permalink to this equation">#</a></span>\[\begin{equation}
u_{i+1,j} + u_{i,j+1} + u_{i-1,j} + u_{i,j-1} - 4 u_{i,j} = 0 \;.
\end{equation}\]</div>
<section id="example-heat-transfer-in-a-square-plate">
<h2><span class="section-number">5.1.1. </span>Example: heat transfer in a square plate<a class="headerlink" href="#example-heat-transfer-in-a-square-plate" title="Permalink to this headline">#</a></h2>
<p>As an example, let’s consider the problem of steady-state heat transfer in a square solid object. If <span class="math notranslate nohighlight">\(u(x,y)\)</span> is temperature, then this is described by Laplace’s equation:</p>
<div class="amsmath math notranslate nohighlight" id="equation-f64316a5-340f-4d53-912c-8d62d2595111">
<span class="eqno">(5.8)<a class="headerlink" href="#equation-f64316a5-340f-4d53-912c-8d62d2595111" title="Permalink to this equation">#</a></span>\[\begin{equation}
\frac{\partial^2 u}{\partial x^2} + \frac{\partial^2 u}{\partial y^2} = \nabla^2 u = 0 \;,
\end{equation}\]</div>
<p>and we can solve this using finite differences. Using a uniform grid where <span class="math notranslate nohighlight">\(\Delta x = \Delta y = h\)</span>, Laplace’s equation gives us a recursion formula that relates the values at neighboring points:</p>
<div class="amsmath math notranslate nohighlight" id="equation-b0295791-9abe-4bb2-bfc4-3ae217a82d14">
<span class="eqno">(5.9)<a class="headerlink" href="#equation-b0295791-9abe-4bb2-bfc4-3ae217a82d14" title="Permalink to this equation">#</a></span>\[\begin{equation}
u_{i+1,j} + u_{i,j+1} + u_{i-1,j} + u_{i,j-1} - 4 u_{i,j} = 0 \;.
\end{equation}\]</div>
<p>Consider a case where the square has sides of length <span class="math notranslate nohighlight">\(L\)</span>, and the boundary conditions are that the temperature is fixed at 100 on the left, right, and bottom sides, and fixed at 0 on the top.
For now, we’ll use two segments to discretize the domain in each directions, giving us nine total points in the grid.
The following figures show the example problem, and the grid of points we’ll use.</p>
<figure class="align-default" id="fig-heat-transfer-square">
<a class="bg-white mb-1 reference internal image-reference" href="../../_images/heat-transfer-square.png"><img alt="Heat transfer in a square" class="bg-white mb-1" src="../../_images/heat-transfer-square.png" style="width: 300px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 5.2 </span><span class="caption-text">Heat transfer in a square object</span><a class="headerlink" href="#fig-heat-transfer-square" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-default" id="fig-grid-three">
<a class="bg-white mb-1 reference internal image-reference" href="../../_images/heat-equation-grid.png"><img alt="3x3 grid of points" class="bg-white mb-1" src="../../_images/heat-equation-grid.png" style="width: 300px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 5.3 </span><span class="caption-text">Simple 3x3 grid of points</span><a class="headerlink" href="#fig-grid-three" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Using the above recursion formula, we can write an equation for each of the nine unknown points (in the interior, not the boundary points):</p>
<div class="amsmath math notranslate nohighlight" id="equation-8a0eb028-a3ea-4781-a561-e43f789628db">
<span class="eqno">(5.10)<a class="headerlink" href="#equation-8a0eb028-a3ea-4781-a561-e43f789628db" title="Permalink to this equation">#</a></span>\[\begin{align}
u_{0,0} &amp;= 100 \\
u_{1,0} &amp;= 100 \\
u_{2,0} &amp;= 100 \\
u_{0,1} &amp;= 100 \\
\text{for } u_{1,1}: \quad u_{2,1} + u_{1,2} + u_{0,1} + u_{1,0} - 4u_{1,1} &amp;= 0 \\
u_{2,1} &amp;= 100 \\
u_{0,2} &amp;= 100 \\
u_{1,2} &amp;= 0 \\
u_{2,2} &amp;= 100
\end{align}\]</div>
<p>where <span class="math notranslate nohighlight">\(u_{i,j}\)</span> are the unknowns. Note that in this we used the side boundary condition values for the corner points <span class="math notranslate nohighlight">\(u_{0,2}\)</span> and <span class="math notranslate nohighlight">\(u_{2,2}\)</span>, rather than the top value. (In reality this would represent a discontinuity in temperature, so these aren’t very realistic boundary conditions.)</p>
<p>This is a system of linear equations, that we can represent as a matrix-vector product:</p>
<div class="amsmath math notranslate nohighlight" id="equation-d66464ea-849d-40ee-b019-e9075e85efe9">
<span class="eqno">(5.11)<a class="headerlink" href="#equation-d66464ea-849d-40ee-b019-e9075e85efe9" title="Permalink to this equation">#</a></span>\[\begin{align}
\begin{bmatrix} 
1 &amp; 0 &amp; 0 &amp; 0 &amp;  0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 0 &amp;  0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; 0 &amp;  0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1 &amp;  0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 1 &amp; -4 &amp; 1 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp;  0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp;  0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp;  0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp;  0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 \\\end{bmatrix}
\begin{bmatrix} u_{0,0} \\ u_{1,0} \\ u_{2,0} \\ u_{0,1} \\ u_{1,1} \\ u_{2,1} \\ u_{0,2} \\ u_{1,2} \\ u_{2,2} \end{bmatrix} &amp;= 
\begin{bmatrix} 100 \\ 100 \\ 100 \\ 
100 \\ 0 \\ 100 \\
100 \\ 0 \\ 100 \end{bmatrix} \\
\text{or} \quad A \mathbf{u} &amp;= \mathbf{b}
\end{align}\]</div>
<p>where <span class="math notranslate nohighlight">\(A\)</span> is a <span class="math notranslate nohighlight">\(9\times 9\)</span> coefficient matrix, <span class="math notranslate nohighlight">\(\mathbf{u}\)</span> is a nine-element vector of unknown variables, and <span class="math notranslate nohighlight">\(\mathbf{b}\)</span> is a nine-element right-hand side vector.
For <span class="math notranslate nohighlight">\(\mathbf{u}\)</span>, we had to take variables that physically represent points in a two-dimensional space and combine them in some order to form a one-dimensional column vector. Here, we used a <strong>row-major</strong> mapping, where we started with the point in the first row and first column, then added the remaining points in that row, before moving to the next row and repeating. We’ll discuss this a bit more later.</p>
<p>If we set this up in Python, we can solve using <code class="docutils literal notranslate"><span class="pre">np.linalg.solve()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">])</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[100. 100. 100. 100.  75. 100. 100.   0. 100.]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># alternatively, for creating the A matrix, we could create</span>
<span class="c1"># a diagonal matrix of ones and then only modify the one row</span>
<span class="c1"># that needs it</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="n">A</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">A</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">A</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span>
<span class="n">A</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">A</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">u2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">u</span> <span class="o">==</span> <span class="n">u2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This gives us the values for temperature at each of the nine points. In this example, we really only have one unknown temperature: <span class="math notranslate nohighlight">\(u_{1,1}\)</span>, located in the middle. Does the value given make sense? We can check by rearranging the recursion formula for Laplace’s equation:</p>
<div class="amsmath math notranslate nohighlight" id="equation-51752966-fec6-4f57-b2ff-5401e358d164">
<span class="eqno">(5.12)<a class="headerlink" href="#equation-51752966-fec6-4f57-b2ff-5401e358d164" title="Permalink to this equation">#</a></span>\[\begin{equation}
u_{i,j} = \frac{u_{i+1,j} + u_{i,j+1} + u_{i-1,j} + u_{i,j-1}}{4} \;,
\end{equation}\]</div>
<p>which shows that in such problems the value of the middle point should be the average of the four surrounding points. This matches the value of 75 found above.</p>
<p>We can use a contour plot to visualize the results, though we’ll need to convert the one-dimensional solution array into a two-dimensional matrix to plot. The NumPy <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.reshape.html"><code class="docutils literal notranslate"><span class="pre">reshape()</span></code></a> function can help us here: it can reshapes a one-dimensional array into a two-dimensional array, by specifying the target number of desired rows and columns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example of using the reshape method, with a simple array </span>
<span class="c1"># going from 1 to 10</span>

<span class="c1"># We want to convert it into a 2D array with 2 row and 5 columns.</span>
<span class="c1"># The expected output is:</span>
<span class="c1"># [[0, 1, 2, 3, 4],</span>
<span class="c1">#  [5, 6, 7, 8, 9]]</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[0 1 2 3 4]
 [5 6 7 8 9]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We can use the reshape function to convert the calculated </span>
<span class="c1"># temperatures into a 3x3 array:</span>

<span class="n">num_x</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">num_y</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">u_square</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="p">[</span><span class="n">num_y</span><span class="p">,</span> <span class="n">num_x</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">u_square</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/454fade00fbe8f0d7c90d792d7b58fd9a38ae09b87bb255d8c2924ad2936056d.png" src="../../_images/454fade00fbe8f0d7c90d792d7b58fd9a38ae09b87bb255d8c2924ad2936056d.png" />
</div>
</div>
<p>Overall that looks correct: the boundary conditions are right, and we see that the center is the average of the boundaries.</p>
<p>But, clearly only using nine points (with eight of those being boundary conditions) doesn’t give us a very good solution. To make this more accurate, we’ll need to use more points, which also means we need to automate the construction of the system of equations.</p>
</section>
<section id="row-major-mapping">
<h2><span class="section-number">5.1.2. </span>Row-major mapping<a class="headerlink" href="#row-major-mapping" title="Permalink to this headline">#</a></h2>
<p>For a two-dimensional elliptic PDE like Laplace’s equation, we can generate a general recursion formula, but we need a way to take a grid of points where location is defined by row and column index and map these into a one-dimensional column vector, which has its own index.</p>
<p>The following figure shows a general 2D grid of points, with <span class="math notranslate nohighlight">\(n\)</span> number of columns in the <span class="math notranslate nohighlight">\(x\)</span> direction (using index <span class="math notranslate nohighlight">\(i\)</span>) and <span class="math notranslate nohighlight">\(m\)</span> number of rows in the <span class="math notranslate nohighlight">\(y\)</span> direction (using index <span class="math notranslate nohighlight">\(j\)</span>):</p>
<figure class="align-default" id="fig-twodim-grid">
<a class="bg-white mb-1 reference internal image-reference" href="../../_images/row-major.png"><img alt="2D grid of points" class="bg-white mb-1" src="../../_images/row-major.png" style="width: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 5.4 </span><span class="caption-text">2D grid of points with <em>n</em> columns and <em>m</em> columns.</span><a class="headerlink" href="#fig-twodim-grid" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>We want to convert the rows and columns of <span class="math notranslate nohighlight">\(u_{i,j}\)</span> points defined by column and row index into a single column array using a different index, <span class="math notranslate nohighlight">\(k\)</span> (this choice is arbitrary):</p>
<div class="amsmath math notranslate nohighlight" id="equation-03de1758-a2d2-413e-9d30-8f1abe0476a1">
<span class="eqno">(5.13)<a class="headerlink" href="#equation-03de1758-a2d2-413e-9d30-8f1abe0476a1" title="Permalink to this equation">#</a></span>\[\begin{equation}
\begin{bmatrix} u_{0,0} \\ u_{1,0} \\ u_{2,0} \\ \vdots \\ u_{n-1,0} \\
u_{0,1} \\ u_{1,1} \\ u_{2,1} \\ \vdots \\ u_{n-1, 1} \\ u_{0,2} \\ \vdots \\
u_{0,m-1} \\ u_{1,m-1} \\ \vdots \\ u_{n-1,m-1}
\end{bmatrix}
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(k\)</span> refers to the index used in that array.</p>
<p>To do this mapping, we can use this formula:</p>
<div class="amsmath math notranslate nohighlight" id="equation-50d2e2db-a2a1-49cf-85b0-1ddeb03d807a">
<span class="eqno">(5.14)<a class="headerlink" href="#equation-50d2e2db-a2a1-49cf-85b0-1ddeb03d807a" title="Permalink to this equation">#</a></span>\[\begin{equation}
k_{i,j} = j n + i
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(k_{i,j}\)</span> refers to the 1D index <span class="math notranslate nohighlight">\(k\)</span> mapped from the 2D indices <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span>.</p>
<figure class="align-default" id="fig-grid-three2">
<a class="bg-primary mb-1 reference internal image-reference" href="../../_images/heat-equation-grid.png"><img alt="3x3 grid of points" class="bg-primary mb-1" src="../../_images/heat-equation-grid.png" style="width: 250px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 5.5 </span><span class="caption-text">Simple 3x3 grid of points</span><a class="headerlink" href="#fig-grid-three2" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>For example, in this <span class="math notranslate nohighlight">\(3\times 3\)</span> grid, where <span class="math notranslate nohighlight">\(n=3\)</span> and <span class="math notranslate nohighlight">\(m=3\)</span>, consider the point where <span class="math notranslate nohighlight">\(i=1\)</span> and <span class="math notranslate nohighlight">\(j=1\)</span> (the point right in the center).
Using our formula,</p>
<div class="amsmath math notranslate nohighlight" id="equation-49c9e28f-12fb-442a-8473-721488fdc2de">
<span class="eqno">(5.15)<a class="headerlink" href="#equation-49c9e28f-12fb-442a-8473-721488fdc2de" title="Permalink to this equation">#</a></span>\[\begin{equation}
k_{1,1} = (1) 3 + 1 = 4
\end{equation}\]</div>
<p>which matches what we can visually confirm: the fifth point, which would have index 4.</p>
<p>Using that mapping, we can also identify the 1D indices associated with the points surrounding location <span class="math notranslate nohighlight">\((i,j)\)</span>:</p>
<div class="amsmath math notranslate nohighlight" id="equation-bb73ffc6-abc8-44d2-97d1-0ec7b29c2bad">
<span class="eqno">(5.16)<a class="headerlink" href="#equation-bb73ffc6-abc8-44d2-97d1-0ec7b29c2bad" title="Permalink to this equation">#</a></span>\[\begin{align}
k_{i-1,j} &amp;= j n + i - 1 \\
k_{i+1,j} &amp;= j n + i + 1 \\
k_{i,j-1} &amp;= (j-1)n + i \\
k_{i,j+1} &amp;= (j+1) n + i
\end{align}\]</div>
<p>which we can use to determine the appropriate locations to place values in the coefficient and right-hand side matrices.</p>
</section>
<section id="example-heat-transfer-in-a-square-plate-redux">
<h2><span class="section-number">5.1.3. </span>Example: heat transfer in a square plate (redux)<a class="headerlink" href="#example-heat-transfer-in-a-square-plate-redux" title="Permalink to this headline">#</a></h2>
<p>Let’s return to the example of steady-state heat transfer in a square plate—but this time we’ll set the solution up more generally so we can vary the step size <span class="math notranslate nohighlight">\(h = \Delta x = \Delta y\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">length_x</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">length_y</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">x_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length_x</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
<span class="n">y_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length_y</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

<span class="c1"># The coefficient matrix A is now m*n by m*n, </span>
<span class="c1"># since that is the total number of points.</span>
<span class="c1"># The right-hand side vector b is m*n by 1.</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y_vals</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y_vals</span><span class="p">)))</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y_vals</span><span class="p">))</span>

<span class="n">u_left</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">u_right</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">u_bottom</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">u_top</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y_vals</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x_vals</span><span class="p">):</span>
        <span class="c1"># for convenience, calculate all indices now</span>
        <span class="n">kij</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span>
        <span class="n">kim1j</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">kip1j</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">kijm1</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span>
        <span class="n">kijp1</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># this is the left boundary</span>
            <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">b</span><span class="p">[</span><span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_left</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># right boundary</span>
            <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">b</span><span class="p">[</span><span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_right</span>
        <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># bottom boundary</span>
            <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">b</span><span class="p">[</span><span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_bottom</span>
        <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_vals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># top boundary</span>
            <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">b</span><span class="p">[</span><span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_top</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># coefficients for interior points, based</span>
            <span class="c1"># on the recursion formula</span>
            <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kim1j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kip1j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kijm1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kijp1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="n">u_square</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_vals</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span> <span class="n">y_vals</span><span class="p">,</span> <span class="n">u_square</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Temperature&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/939f078c1cd2288d6cddc83c652afc8b464955f109990d38d41782896f0e6d59.png" src="../../_images/939f078c1cd2288d6cddc83c652afc8b464955f109990d38d41782896f0e6d59.png" />
</div>
</div>
</section>
<section id="neumann-derivative-boundary-conditions">
<h2><span class="section-number">5.1.4. </span>Neumann (derivative) boundary conditions<a class="headerlink" href="#neumann-derivative-boundary-conditions" title="Permalink to this headline">#</a></h2>
<p>So far, we have only discussed cases where we have Dirichlet boundary conditions; in other words, when we have all fixed values at the boundary. Frequently we also encounter Neumann-style boundary conditions, where we have the <em>derivative</em> specified at the boundary.</p>
<p>We can handle this in the same way we do for one-dimensional boundary value problems: either with a forward or backward difference (both of which are first-order accurate), or with a central difference using an imaginary point/ghost node (which is second-order accurate). Let’s focus on using the central difference, since it is more accurate.</p>
<figure class="align-default" id="fig-ghost-node">
<a class="bg-primary mb-1 reference internal image-reference" href="../../_images/2d-ghost-node.png"><img alt="ghost node at boundary" class="bg-primary mb-1" src="../../_images/2d-ghost-node.png" style="width: 250px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 5.6 </span><span class="caption-text">Ghost/imaginary node beyond an upper boundary</span><a class="headerlink" href="#fig-ghost-node" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>For example, let’s say that at the upper boundary, the derivative of temperature is zero:</p>
<div class="amsmath math notranslate nohighlight" id="equation-e5f8b639-57af-4292-b870-0a794ed63204">
<span class="eqno">(5.17)<a class="headerlink" href="#equation-e5f8b639-57af-4292-b870-0a794ed63204" title="Permalink to this equation">#</a></span>\[\begin{equation}
\left. \frac{\partial u}{\partial y} \right|_{\text{boundary}} = 0
\end{equation}\]</div>
<p>Let’s consider this boundary condition applied at the point shown, <span class="math notranslate nohighlight">\(u_{2,3}\)</span>.
We can approximate this derivative using a central difference:</p>
<div class="amsmath math notranslate nohighlight" id="equation-8406212b-2b9d-4d7d-a570-4bc98c334a56">
<span class="eqno">(5.18)<a class="headerlink" href="#equation-8406212b-2b9d-4d7d-a570-4bc98c334a56" title="Permalink to this equation">#</a></span>\[\begin{align}
\frac{u_{2,3}}{\partial y} \approx \frac{u_{2,4} - u_{2,2}}{\Delta x} &amp;= 0 \\
u_{2,4} &amp;= u_{2,2}
\end{align}\]</div>
<p>This tells us the value of the point above the boundary, <span class="math notranslate nohighlight">\(u_{2,4}\)</span>; however, this point is a “ghost” or imaginary point located outside the boundary, so we don’t really care about its value. Instead, we can use this relationship to give us a usable equation for the boundary point, by incorporating it into the normal recursion formula for Laplace’s equation:</p>
<div class="amsmath math notranslate nohighlight" id="equation-6fca6a80-69df-46ca-9e18-612a71c342d1">
<span class="eqno">(5.19)<a class="headerlink" href="#equation-6fca6a80-69df-46ca-9e18-612a71c342d1" title="Permalink to this equation">#</a></span>\[\begin{align}
u_{1,3} + u_{3,3} + u_{2,4} + u_{2,2} - 4u_{2,3} &amp;= 0 \\
u_{1,3} + u_{3,3} + u_{2,2} + u_{2,2} - 4u_{2,3} &amp;= 0 \\
\rightarrow u_{1,3} + u_{3,3} + 2 u_{2,2} - 4u_{2,3} &amp;= 0
\end{align}\]</div>
<p>The recursion formula for points along the upper boundary would then become</p>
<div class="amsmath math notranslate nohighlight" id="equation-2a0f2361-7fc3-4d40-adea-a922f3b9cfa4">
<span class="eqno">(5.20)<a class="headerlink" href="#equation-2a0f2361-7fc3-4d40-adea-a922f3b9cfa4" title="Permalink to this equation">#</a></span>\[\begin{equation}
u_{i+1,j} + u_{i-1,j} + 2 u_{i,j-1} - 4 u_{i,j} = 0 \;.
\end{equation}\]</div>
<p>Now let’s try solving the above example, but with <span class="math notranslate nohighlight">\(\frac{\partial u}{\partial y} = 0\)</span> at the top boundary and <span class="math notranslate nohighlight">\(u = 0\)</span> at the bottom boundary:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">length_x</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">length_y</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">x_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length_x</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
<span class="n">y_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length_y</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

<span class="c1"># The coefficient matrix A is now m*n by m*n, </span>
<span class="c1"># since that is the total number of points.</span>
<span class="c1"># The right-hand side vector b is m*n by 1.</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y_vals</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y_vals</span><span class="p">)))</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y_vals</span><span class="p">))</span>

<span class="n">u_left</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">u_right</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">u_bottom</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1"># u_top is not needed, insulated BC</span>

<span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y_vals</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x_vals</span><span class="p">):</span>
        <span class="c1"># for convenience, calculate all indices now</span>
        <span class="n">kij</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span>
        <span class="n">kim1j</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">kip1j</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">kijm1</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span>
        <span class="n">kijp1</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># this is the left boundary</span>
            <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">b</span><span class="p">[</span><span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_left</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># right boundary</span>
            <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">b</span><span class="p">[</span><span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_right</span>
        <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># bottom boundary</span>
            <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">b</span><span class="p">[</span><span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_bottom</span>
        <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_vals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># top boundary, using the ghost node + recursion formula            </span>
            <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kim1j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kip1j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kijm1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># coefficients for interior points, based</span>
            <span class="c1"># on the recursion formula</span>
            <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kim1j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kip1j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kijm1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kijp1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="n">u_square</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_vals</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span> <span class="n">y_vals</span><span class="p">,</span> <span class="n">u_square</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Temperature&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/1dbc73bcd775829b3d4f13adb90499aebf0e84b9f5ed88a84aac6b26cde3d9ba.png" src="../../_images/1dbc73bcd775829b3d4f13adb90499aebf0e84b9f5ed88a84aac6b26cde3d9ba.png" />
</div>
</div>
</section>
<section id="iterative-solutions-for-very-large-problems">
<h2><span class="section-number">5.1.5. </span>Iterative solutions for (very) large problems<a class="headerlink" href="#iterative-solutions-for-very-large-problems" title="Permalink to this headline">#</a></h2>
<p>So far, we’ve been able to solve our systems of linear equations in Python by using <code class="docutils literal notranslate"><span class="pre">np.linalg.solve()</span></code>, which directly finds the solution to the equation <span class="math notranslate nohighlight">\(A \mathbf{y} = \mathbf{b}\)</span>.</p>
<p>However, this approach will become very slow as the grid resolution (<span class="math notranslate nohighlight">\(h = \Delta x = \Delta y\)</span>) becomes smaller, and eventually unfeasable due to the associated computational requirements. First, let’s create a function that takes as input the segment size <span class="math notranslate nohighlight">\(h\)</span>, then returns the time it takes to solve the problem for different sizes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span> 

<span class="k">def</span> <span class="nf">heat_equation</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Solves 2D steady heat equation problem given step size&#39;&#39;&#39;</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    
    <span class="n">length_x</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">length_y</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">x_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length_x</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
    <span class="n">y_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length_y</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
    
    <span class="n">num_pts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y_vals</span><span class="p">)</span>

    <span class="c1"># The coefficient matrix A is now m*n by m*n, </span>
    <span class="c1"># since that is the total number of points.</span>
    <span class="c1"># The right-hand side vector b is m*n by 1.</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_pts</span><span class="p">,</span> <span class="n">num_pts</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_pts</span><span class="p">)</span>

    <span class="n">u_left</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">u_right</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">u_bottom</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">u_top</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y_vals</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x_vals</span><span class="p">):</span>
            <span class="c1"># for convenience, calculate all indices now</span>
            <span class="n">kij</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span>
            <span class="n">kim1j</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">kip1j</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">kijm1</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span>
            <span class="n">kijp1</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># this is the left boundary</span>
                <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">b</span><span class="p">[</span><span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_left</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># right boundary</span>
                <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">b</span><span class="p">[</span><span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_right</span>
            <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># bottom boundary</span>
                <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">b</span><span class="p">[</span><span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_bottom</span>
            <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_vals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># top boundary</span>
                <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">b</span><span class="p">[</span><span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_top</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># coefficients for interior points, based</span>
                <span class="c1"># on the recursion formula</span>
                <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kim1j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kip1j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kijm1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kijp1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">A</span><span class="p">[</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">u_square</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_vals</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)))</span>
    
    <span class="k">return</span> <span class="n">num_pts</span><span class="p">,</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we can see how long it takes to solve as we increase the resolution, and get an idea about the relationship between time-to-solution and number of unknowns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">step_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.0125</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>

<span class="n">num_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">step_sizes</span><span class="p">))</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">num_pts</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">step_size</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">step_sizes</span><span class="p">):</span>
    <span class="n">num_pts</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">times</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">heat_equation</span><span class="p">(</span><span class="n">step_size</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_pts</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual cost&#39;</span><span class="p">)</span>
<span class="c1">#plt.loglog(nums, times, &#39;-o&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of unknowns&#39;</span><span class="p">);</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Time for direct solution (sec)&#39;</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">num_pts</span><span class="p">[:]</span>
<span class="n">n2</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> 
<span class="n">n3</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;quadratic&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/dac150d470553d11c7c50e1bc6da50b65579865babfe54328f35fac255180845.png" src="../../_images/dac150d470553d11c7c50e1bc6da50b65579865babfe54328f35fac255180845.png" />
</div>
</div>
<p>After about 100 points/unknowns, the cost begins increasing exponentially with the number of points, somewhere between quadratic (<span class="math notranslate nohighlight">\(\mathcal{O}(n^2)\)</span>) and cubic (<span class="math notranslate nohighlight">\(\mathcal{O}(n^3)\)</span>).</p>
<p>If we try to reduce the step size further, for example to 0.005, we’ll see that we cannot get a solution in a reasonable amount of time. But, clearly we want to get solutions for large numbers of unknowns, so what can we do?</p>
<p>We can solve larger systems of linear equations using <em>iterative</em> methods. There are a number of these, and we’ll focus on two:</p>
<ul class="simple">
<li><p>Jacobi method</p></li>
<li><p>Gauss-Seidel method</p></li>
</ul>
<section id="jacobi-method">
<h3><span class="section-number">5.1.5.1. </span>Jacobi method<a class="headerlink" href="#jacobi-method" title="Permalink to this headline">#</a></h3>
<p>The Jacobi method essentially works by starting with an initial guess to the solution, then using the recursion formula to solve for values at each point, then repeating this until the values converge (i.e., stop changing).</p>
<p>An algorithm we can use to solve Laplace’s equation:</p>
<ol class="arabic simple">
<li><p>Set some initial guess for all unknowns: <span class="math notranslate nohighlight">\(u_{i,j}^{\text{old}}\)</span></p></li>
<li><p>Set the boundary values</p></li>
<li><p>For each point in the interior, use the recursion formula to solve for new values based on old values at the surrounding points: <span class="math notranslate nohighlight">\(u_{i,j} = \left( u_{i+1,j}^{\text{old}} + u_{i-1,j}^{\text{old}} + u_{i,j+1}^{\text{old}} + u_{i,j-1}^{\text{old}} \right)/4\)</span>.</p></li>
<li><p>Check for convergence: is <span class="math notranslate nohighlight">\(\epsilon\)</span> less than some tolerance, such as <span class="math notranslate nohighlight">\(10^{-6}\)</span>? Where <span class="math notranslate nohighlight">\(\epsilon = \max \left| u_{i,j} - u_{i,j}^{\text{old}} \right|\)</span>. If no, then return to step 2 and repeat.</p></li>
</ol>
<p>More formally, if we have a system <span class="math notranslate nohighlight">\(A \mathbf{x} = \mathbf{b}\)</span>, where</p>
<div class="amsmath math notranslate nohighlight" id="equation-d30347d6-2ce8-4713-9424-f9ecdf6cf5e9">
<span class="eqno">(5.21)<a class="headerlink" href="#equation-d30347d6-2ce8-4713-9424-f9ecdf6cf5e9" title="Permalink to this equation">#</a></span>\[\begin{equation}
A = \begin{bmatrix}
a_{0,0} &amp; a_{0,1} &amp; \cdots &amp; a_{0,n-1} \\
a_{1,0} &amp; a_{1,1} &amp; \cdots &amp; a_{1,n-1} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
a_{n-1,0} &amp; a_{n-1,1} &amp; \cdots &amp; a_{n-1,n-1} \end{bmatrix}
\quad \mathbf{x} = \begin{bmatrix} x_0 \\ x_1 \\ \vdots \\ x_{n-1} \end{bmatrix}
\quad \mathbf{b} = \begin{bmatrix} b_0 \\ b_1 \\ \vdots \\ b_{n-1} \end{bmatrix}
\end{equation}\]</div>
<p>then we can solve iterative for <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> using</p>
<div class="amsmath math notranslate nohighlight" id="equation-b024adc3-c769-4354-8744-cf8d46a5bb6e">
<span class="eqno">(5.22)<a class="headerlink" href="#equation-b024adc3-c769-4354-8744-cf8d46a5bb6e" title="Permalink to this equation">#</a></span>\[\begin{equation}
x_i^{(k+1)} = \frac{1}{a_{ii}} \left( b_i - \sum_{j \neq i} a_{ij} x_j^{(k)} \right) , \quad i = 0,1,\ldots, n-1
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(x_i^{(k)}\)</span> is a value of the solution at iteration <span class="math notranslate nohighlight">\(k\)</span> and <span class="math notranslate nohighlight">\(x_i^{(k+1)}\)</span> is at the next iteration.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">heat_equation_jacobi</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Solves heat equation using Jacobi iteration&#39;&#39;&#39;</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    
    <span class="n">length_x</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">length_y</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">x_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length_x</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
    <span class="n">y_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length_y</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
    
    <span class="n">num_pts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y_vals</span><span class="p">)</span>

    <span class="c1"># initial guess</span>
    <span class="n">u</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_pts</span><span class="p">)</span>

    <span class="n">u_left</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">u_right</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">u_bottom</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">u_top</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c1"># dummy value for residual variable</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1.0</span>
    
    <span class="n">num_iter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">epsilon</span> <span class="o">&gt;</span> <span class="mf">1e-2</span><span class="p">:</span>
        <span class="n">u_old</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y_vals</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x_vals</span><span class="p">):</span>
                <span class="c1"># for convenience, calculate all indices now</span>
                <span class="n">kij</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span>
                <span class="n">kim1j</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">kip1j</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">kijm1</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span>
                <span class="n">kijp1</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># this is the left boundary</span>
                    <span class="n">u</span><span class="p">[</span><span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_left</span>
                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># right boundary</span>
                    <span class="n">u</span><span class="p">[</span><span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_right</span>
                <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># bottom boundary</span>
                    <span class="n">u</span><span class="p">[</span><span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_bottom</span>
                <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_vals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># top boundary</span>
                    <span class="n">u</span><span class="p">[</span><span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_top</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># interior points</span>
                    <span class="n">u</span><span class="p">[</span><span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">u_old</span><span class="p">[</span><span class="n">kip1j</span><span class="p">]</span> <span class="o">+</span> <span class="n">u_old</span><span class="p">[</span><span class="n">kim1j</span><span class="p">]</span> <span class="o">+</span> 
                        <span class="n">u_old</span><span class="p">[</span><span class="n">kijm1</span><span class="p">]</span> <span class="o">+</span> <span class="n">u_old</span><span class="p">[</span><span class="n">kijp1</span><span class="p">]</span>
                        <span class="p">)</span> <span class="o">/</span> <span class="mf">4.0</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">u_old</span><span class="p">))</span>
        <span class="n">num_iter</span> <span class="o">+=</span> <span class="mi">1</span>
    
    <span class="n">u_square</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_vals</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)))</span>
    <span class="c1"># use a dict to package a large number of return objects</span>
    <span class="n">solution</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;num_points&#39;</span><span class="p">:</span> <span class="n">num_pts</span><span class="p">,</span>
                <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span>
                <span class="s1">&#39;num_iter&#39;</span><span class="p">:</span> <span class="n">num_iter</span><span class="p">,</span>
                <span class="s1">&#39;u&#39;</span><span class="p">:</span> <span class="n">u_square</span><span class="p">,</span>
                <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x_vals</span><span class="p">,</span>
                <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y_vals</span>
                <span class="p">}</span>
    
    <span class="k">return</span> <span class="n">solution</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">step_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.0125</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">]</span>

<span class="n">num_pts_jac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">step_sizes</span><span class="p">))</span>
<span class="n">times_jac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">num_pts_jac</span><span class="p">)</span>
<span class="n">num_iter_jac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">num_pts_jac</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">step_size</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">step_sizes</span><span class="p">):</span>
    <span class="n">sol</span> <span class="o">=</span> <span class="n">heat_equation_jacobi</span><span class="p">(</span><span class="n">step_size</span><span class="p">)</span>
    <span class="n">num_pts_jac</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="s1">&#39;num_points&#39;</span><span class="p">]</span>
    <span class="n">times_jac</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
    <span class="n">num_iter_jac</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="s1">&#39;num_iter&#39;</span><span class="p">]</span>
    <span class="n">x_vals</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
    <span class="n">y_vals</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of iterations: </span><span class="si">{</span><span class="n">sol</span><span class="p">[</span><span class="s1">&#39;num_iter&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of iterations: 33
Number of iterations: 107
Number of iterations: 317
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of iterations: 822
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of iterations: 1062
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of iterations: 1637
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of iterations: 1910
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">line</span> <span class="mi">7</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">num_iter_jac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">num_pts_jac</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">step_size</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">step_sizes</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">7</span>     <span class="n">sol</span> <span class="o">=</span> <span class="n">heat_equation_jacobi</span><span class="p">(</span><span class="n">step_size</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">num_pts_jac</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="s1">&#39;num_points&#39;</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="n">times_jac</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>

<span class="nn">Cell In[12], line 34,</span> in <span class="ni">heat_equation_jacobi</span><span class="nt">(h)</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span> <span class="n">kim1j</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="n">kip1j</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<span class="ne">---&gt; </span><span class="mi">34</span> <span class="n">kijm1</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span>
<span class="g g-Whitespace">     </span><span class="mi">35</span> <span class="n">kijp1</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span>
<span class="g g-Whitespace">     </span><span class="mi">36</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">37</span>     <span class="c1"># this is the left boundary</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
</section>
<section id="gauss-seidel-method">
<h3><span class="section-number">5.1.5.2. </span>Gauss-Seidel method<a class="headerlink" href="#gauss-seidel-method" title="Permalink to this headline">#</a></h3>
<p>The Gauss-Seidel method is very similar to the Jacobi method, but with one important difference: rather than using all old values to calculate the new values, incorporate updated values as they are available. Because the method incorporates newer information more quickly, it tends to converge faster (meaning, with fewer iterations) than the Jacobi method.</p>
<p>Formally, if we have a system <span class="math notranslate nohighlight">\(A \mathbf{x} = \mathbf{b}\)</span>, where</p>
<div class="amsmath math notranslate nohighlight" id="equation-a018c961-a6be-4a53-ac34-0acdef7dcb76">
<span class="eqno">(5.23)<a class="headerlink" href="#equation-a018c961-a6be-4a53-ac34-0acdef7dcb76" title="Permalink to this equation">#</a></span>\[\begin{equation}
A = \begin{bmatrix}
a_{0,0} &amp; a_{0,1} &amp; \cdots &amp; a_{0,n-1} \\
a_{1,0} &amp; a_{1,1} &amp; \cdots &amp; a_{1,n-1} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
a_{n-1,0} &amp; a_{n-1,1} &amp; \cdots &amp; a_{n-1,n-1} \end{bmatrix}
\quad \mathbf{x} = \begin{bmatrix} x_0 \\ x_1 \\ \vdots \\ x_{n-1} \end{bmatrix}
\quad \mathbf{b} = \begin{bmatrix} b_0 \\ b_1 \\ \vdots \\ b_{n-1} \end{bmatrix}
\end{equation}\]</div>
<p>then we can solve iterative for <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> using</p>
<div class="amsmath math notranslate nohighlight" id="equation-d8813529-a934-44a6-adc8-a422163f9360">
<span class="eqno">(5.24)<a class="headerlink" href="#equation-d8813529-a934-44a6-adc8-a422163f9360" title="Permalink to this equation">#</a></span>\[\begin{equation}
x_i^{(k+1)} = \frac{1}{a_{ii}} \left( b_i - \sum_{j=1}^{i-1} a_{ij} x_j^{(k+1)} - \sum_{j =i+1}^n a_{ij} x_j^{(k)} \right) , \quad i = 0,1,\ldots, n-1
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(x_i^{(k)}\)</span> is a value of the solution at iteration <span class="math notranslate nohighlight">\(k\)</span> and <span class="math notranslate nohighlight">\(x_i^{(k+1)}\)</span> is at the next iteration.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">heat_equation_gauss_seidel</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Solves heat equation using the Gauss-Seidel method&#39;&#39;&#39;</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    
    <span class="n">length_x</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">length_y</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">x_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length_x</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
    <span class="n">y_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length_y</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
    
    <span class="n">num_pts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y_vals</span><span class="p">)</span>

    <span class="c1"># initial guess</span>
    <span class="n">u</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_pts</span><span class="p">)</span>

    <span class="n">u_left</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">u_right</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">u_bottom</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">u_top</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c1"># dummy value for residual variable</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1.0</span>
    
    <span class="n">num_iter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">epsilon</span> <span class="o">&gt;</span> <span class="mf">1e-2</span><span class="p">:</span>
        <span class="n">u_old</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y_vals</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x_vals</span><span class="p">):</span>
                <span class="c1"># for convenience, calculate all indices now</span>
                <span class="n">kij</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span>
                <span class="n">kim1j</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">kip1j</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">kijm1</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span>
                <span class="n">kijp1</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># this is the left boundary</span>
                    <span class="n">u</span><span class="p">[</span><span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_left</span>
                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># right boundary</span>
                    <span class="n">u</span><span class="p">[</span><span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_right</span>
                <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># bottom boundary</span>
                    <span class="n">u</span><span class="p">[</span><span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_bottom</span>
                <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_vals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># top boundary</span>
                    <span class="n">u</span><span class="p">[</span><span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_top</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># interior points</span>
                    <span class="n">u</span><span class="p">[</span><span class="n">kij</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">u</span><span class="p">[</span><span class="n">kip1j</span><span class="p">]</span> <span class="o">+</span> <span class="n">u</span><span class="p">[</span><span class="n">kim1j</span><span class="p">]</span> <span class="o">+</span> 
                        <span class="n">u</span><span class="p">[</span><span class="n">kijm1</span><span class="p">]</span> <span class="o">+</span> <span class="n">u</span><span class="p">[</span><span class="n">kijp1</span><span class="p">]</span>
                        <span class="p">)</span> <span class="o">/</span> <span class="mf">4.0</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">u_old</span><span class="p">))</span>
        <span class="n">num_iter</span> <span class="o">+=</span> <span class="mi">1</span>
    
    <span class="n">u_square</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_vals</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)))</span>
    <span class="c1"># use a dict to package a large number of return objects</span>
    <span class="n">solution</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;num_points&#39;</span><span class="p">:</span> <span class="n">num_pts</span><span class="p">,</span>
                <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span>
                <span class="s1">&#39;num_iter&#39;</span><span class="p">:</span> <span class="n">num_iter</span><span class="p">,</span>
                <span class="s1">&#39;u&#39;</span><span class="p">:</span> <span class="n">u_square</span><span class="p">,</span>
                <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x_vals</span><span class="p">,</span>
                <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y_vals</span>
                <span class="p">}</span>
    
    <span class="k">return</span> <span class="n">solution</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">step_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.0125</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">]</span>

<span class="n">num_pts_gs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">step_sizes</span><span class="p">))</span>
<span class="n">times_gs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">num_pts_gs</span><span class="p">)</span>
<span class="n">num_iter_gs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">num_pts_gs</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">step_size</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">step_sizes</span><span class="p">):</span>
    <span class="n">sol</span> <span class="o">=</span> <span class="n">heat_equation_gauss_seidel</span><span class="p">(</span><span class="n">step_size</span><span class="p">)</span>
    <span class="n">num_pts_gs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="s1">&#39;num_points&#39;</span><span class="p">]</span>
    <span class="n">times_gs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
    <span class="n">num_iter_gs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="s1">&#39;num_iter&#39;</span><span class="p">]</span>
    <span class="n">x_vals</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
    <span class="n">y_vals</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of iterations: </span><span class="si">{</span><span class="n">sol</span><span class="p">[</span><span class="s1">&#39;num_iter&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of iterations: 21
Number of iterations: 64
Number of iterations: 193
Number of iterations: 533
Number of iterations: 716
Number of iterations: 1224
Number of iterations: 1502
Number of iterations: 2275
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_pts</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Direct solution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_pts_jac</span><span class="p">,</span> <span class="n">times_jac</span><span class="p">,</span> <span class="s1">&#39;-^&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Jacobi solution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_pts_gs</span><span class="p">,</span> <span class="n">times_gs</span><span class="p">,</span> <span class="s1">&#39;-x&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Gauss-Seidel solution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of unknowns&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Time for solution (sec)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/6799937f08e29cda4c083834c3a37a4c01f3db25f10d1bf4c832bfd9a28cd3fc.png" src="../../_images/6799937f08e29cda4c083834c3a37a4c01f3db25f10d1bf4c832bfd9a28cd3fc.png" />
</div>
</div>
<p>We can see that for smaller numbers of points/unknowns, the direct solution method is faster, but at some point the costs of solving directly (meaning using linear algebra) grow higher.</p>
<p>Due to time and computer memory constraints, we can’t actually show that the direct method takes longer for the smallest step size (0.005)—many computers will run out of memory!</p>
<p>In addition, if you look at the slopes of the costs, the iterative methods have a consistent slope, while the direct method changes slope to grow in cost faster at a certain point.</p>
<p>(Running these tests on different computers might generate slightly different results, but the overall conclusions should stay the same.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_pts_jac</span><span class="p">,</span> <span class="n">num_iter_jac</span><span class="p">,</span> <span class="s1">&#39;-^&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Jacobi method&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_pts_gs</span><span class="p">,</span> <span class="n">num_iter_gs</span><span class="p">,</span> <span class="s1">&#39;-x&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Gauss-Seidel method&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of unknowns&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of iterations required&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/479500ec933b6c1cc9bbf06fd11d3f0879fb785f358f800e01ee04cc1b20aa58.png" src="../../_images/479500ec933b6c1cc9bbf06fd11d3f0879fb785f358f800e01ee04cc1b20aa58.png" />
</div>
</div>
<p>These results show us a few things:</p>
<ul class="simple">
<li><p>For small problem sizes, the direct solution method is faster.</p></li>
<li><p>For the heat equation, once we get to around 10000 unknowns, the methods perform similarly. Beyond this, the direct solution method becomes unreasonably slow, and fails to solve in a reasonable time for a step size of 0.005.</p></li>
<li><p>The Gauss-Seidel method generally converges with around half the number of iterations than the Jacobi method.</p></li>
</ul>
<p>For larger, more-realistic problems, iterative solution methods like Jacobi and Gauss-Seidel are essential.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content/pdes"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="partial-differential-equations.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">5. </span>Partial Differential Equations</p>
      </div>
    </a>
    <a class="right-next"
       href="parabolic.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">5.2. </span>Parabolic PDEs</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-heat-transfer-in-a-square-plate">5.1.1. Example: heat transfer in a square plate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#row-major-mapping">5.1.2. Row-major mapping</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-heat-transfer-in-a-square-plate-redux">5.1.3. Example: heat transfer in a square plate (redux)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#neumann-derivative-boundary-conditions">5.1.4. Neumann (derivative) boundary conditions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#iterative-solutions-for-very-large-problems">5.1.5. Iterative solutions for (very) large problems</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#jacobi-method">5.1.5.1. Jacobi method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gauss-seidel-method">5.1.5.2. Gauss-Seidel method</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Kyle Niemeyer
</p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <p xmlns:dct="http://purl.org/dc/terms/" xmlns:cc="http://creativecommons.org/ns#" class="license-text"><a rel="cc:attributionURL" property="dct:title" href="https://github.com/kyleniemeyer/ME373-book">Mechanical Engineering Methods notes</a> by <span property="cc:attributionName">Kyle Niemeyer</span> is licensed under <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1" /><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1" /><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1" /></a></p>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>