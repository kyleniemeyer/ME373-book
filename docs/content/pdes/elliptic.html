
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>5.1. Elliptic PDEs &#8212; Mechanical Engineering Methods notes</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"TeX": {"Macros": {"vector": ["\\vec{#1}", 1], "uvec": ["\\hat{#1}", 1], "mag": ["\\lVert#1\\rVert", 1], "cross": "\\times", "unit": ["#1~\\mathrm{#2}", 2]}}, "tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://kyleniemeyer.github.io/ME373-book/content/pdes/elliptic.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="5.2. Parabolic PDEs" href="parabolic.html" />
    <link rel="prev" title="5. Partial Differential Equations" href="partial-differential-equations.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Mechanical Engineering Methods notes</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Ordinary Differential Equations
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../first-order.html">
   1. Solutions to 1st-order ODEs
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../numerical-methods/numerical-methods.html">
   2. Numerical Methods
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../numerical-methods/integrals.html">
     2.1. Numerical integrals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../numerical-methods/error.html">
     2.2. Error
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../numerical-methods/initial-value-methods.html">
     2.3. Numerical Solutions of 1st-order ODEs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../numerical-methods/stability.html">
     2.4. Stability and Stiffness
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../second-order/second-order.html">
   3. Second-order Ordinary Differential Equations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../second-order/analytical.html">
     3.1. Analytical Solutions to 2nd-order ODEs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../second-order/initial-value-problems.html">
     3.2. Initial-Value Problems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../second-order/numerical-methods.html">
     3.3. Numerical methods for 2nd-order ODEs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../second-order/fourier-series.html">
     3.4. Fourier Series
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../second-order/power-series.html">
     3.5. Power Series Solutions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../bvps/boundary-value-problems.html">
   4. Boundary Value Problems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../bvps/shooting-method.html">
     4.1. Shooting Method
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../bvps/finite-difference.html">
     4.2. Finite difference method
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../bvps/eigenvalue.html">
     4.3. Eigenvalue problems
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Partial Differential Equations
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="partial-differential-equations.html">
   5. Partial Differential Equations
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     5.1. Elliptic PDEs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="parabolic.html">
     5.2. Parabolic PDEs
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Sample Quizzes
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../quizzes/quiz2-IVPs.html">
   Sample Quiz 2 problems: IVPs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../quizzes/quiz3-BVPs.html">
   Sample Quiz 3 problems: BVPs
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  About
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/kyleniemeyer/ME373-book">
   GitHub repository
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../contributing.html">
   Contributing to Jupyter Book
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/content/pdes/elliptic.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/kyleniemeyer/ME373-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/kyleniemeyer/ME373-book/issues/new?title=Issue%20on%20page%20%2Fcontent/pdes/elliptic.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/kyleniemeyer/ME373-book/edit/master/content/pdes/elliptic.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/kyleniemeyer/ME373-book/master?urlpath=tree/content/pdes/elliptic.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-heat-transfer-in-a-square-plate">
   5.1.1. Example: heat transfer in a square plate
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#row-major-mapping">
   5.1.2. Row-major mapping
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-heat-transfer-in-a-square-plate-redux">
   5.1.3. Example: heat transfer in a square plate (redux)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#neumann-derivative-boundary-conditions">
   5.1.4. Neumann (derivative) boundary conditions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#iterative-solutions-for-very-large-problems">
   5.1.5. Iterative solutions for (very) large problems
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#jacobi-method">
     5.1.5.1. Jacobi method
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gauss-seidel-method">
     5.1.5.2. Gauss-Seidel method
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="elliptic-pdes">
<h1><span class="section-number">5.1. </span>Elliptic PDEs<a class="headerlink" href="#elliptic-pdes" title="Permalink to this headline">¶</a></h1>
<p>The classic example of an elliptic PDE is <strong>Laplace’s equation</strong> (yep, the same Laplace that gave us the Laplace transform), which in two dimensions for a variable <span class="math notranslate nohighlight">\(u(x,y)\)</span> is</p>
<div class="amsmath math notranslate nohighlight" id="equation-8c8fddab-4374-4e3e-8a38-4cf636a207b0">
<span class="eqno">(5.2)<a class="headerlink" href="#equation-8c8fddab-4374-4e3e-8a38-4cf636a207b0" title="Permalink to this equation">¶</a></span>\[\begin{equation}
\frac{\partial^2 u}{\partial x^2} + \frac{\partial^2 u}{\partial y^2} = \nabla^2 u = 0 \;,
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(\nabla\)</span> is del, or nabla, and represents the gradient operator: <span class="math notranslate nohighlight">\(\nabla = \frac{\partial}{\partial x} + \frac{\partial}{\partial y}\)</span>.</p>
<p>Laplace’s equation shows up in a number of physical problems, including heat transfer, fluid dynamics, and electrostatics. For example, the heat equation for conduction in two dimensions is</p>
<div class="amsmath math notranslate nohighlight" id="equation-de746ffa-c3e6-412d-abe8-9814a26c2209">
<span class="eqno">(5.3)<a class="headerlink" href="#equation-de746ffa-c3e6-412d-abe8-9814a26c2209" title="Permalink to this equation">¶</a></span>\[\begin{equation}
\frac{\partial u}{\partial t} = \alpha \left( \frac{\partial^2 u}{\partial x^2} + \frac{\partial^2 u}{\partial y^2} \right) \;,
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(u(x,y,t)\)</span> is temperature and <span class="math notranslate nohighlight">\(\alpha\)</span> is thermal diffusivity. Steady-state heat transfer (meaning after any initial transient period) is then described by Laplace’s equation.</p>
<p>A related elliptic PDE is <strong>Poisson’s equation</strong>:</p>
<div class="amsmath math notranslate nohighlight" id="equation-b7c8a590-6b29-430c-b169-54c05fad9ff0">
<span class="eqno">(5.4)<a class="headerlink" href="#equation-b7c8a590-6b29-430c-b169-54c05fad9ff0" title="Permalink to this equation">¶</a></span>\[\begin{equation}
\nabla^2 u = f(x,y) \;,
\end{equation}\]</div>
<p>which also appears in multiple physical problems—most notably, when solving for pressure in the Navier–Stokes equations.</p>
<p>To numerically solve these equations, and any elliptic PDE, we can use finite differences, where we replace the continuous <span class="math notranslate nohighlight">\(x,y\)</span> domain with a discrete grid of points. This is similar to what we did with boundary-value problems in one dimension—but now we have two dimensions.</p>
<p>To approximate the second derivatives in Laplace’s equation, we can use central differences in both the <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> directions, applied around the <span class="math notranslate nohighlight">\(u_{i,j}\)</span> point:</p>
<div class="amsmath math notranslate nohighlight" id="equation-e84b31f6-63a1-4764-88a8-4037e481e6ec">
<span class="eqno">(5.5)<a class="headerlink" href="#equation-e84b31f6-63a1-4764-88a8-4037e481e6ec" title="Permalink to this equation">¶</a></span>\[\begin{align}
\frac{\partial^2 u}{\partial x^2} &amp;\approx \frac{u_{i-1,j} - 2u_{i,j} + u_{i+1,j}}{\Delta x^2} \\
\frac{\partial^2 u}{\partial y^2} &amp;\approx \frac{u_{i,j-1} - 2u_{i,j} + u_{i,j+1}}{\Delta y^2}
\end{align}\]</div>
<p>where <span class="math notranslate nohighlight">\(i\)</span> is the index used in the <span class="math notranslate nohighlight">\(x\)</span> direction, <span class="math notranslate nohighlight">\(j\)</span> is the index in the <span class="math notranslate nohighlight">\(y\)</span> direction, and <span class="math notranslate nohighlight">\(\Delta x\)</span> and <span class="math notranslate nohighlight">\(\Delta y\)</span> are the step sizes in the <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> directions.
In other words, <span class="math notranslate nohighlight">\(x_i = (i-1) \Delta x\)</span> and <span class="math notranslate nohighlight">\(y_j = (j-1) \Delta y\)</span>.</p>
<p>The following figure shows the points necessary to approximate the partial derivatives in the PDE at a location <span class="math notranslate nohighlight">\((x_i, y_j)\)</span>, for a general 2D region. This is known as a <strong>five-point stencil</strong>:</p>
<div class="figure align-default" id="fig-stencil">
<a class="bg-primary mb-1 reference internal image-reference" href="../../_images/five-point-stencil.png"><img alt="five-point stencil" class="bg-primary mb-1" src="../../_images/five-point-stencil.png" style="width: 350px;" /></a>
<p class="caption"><span class="caption-number">Fig. 5.1 </span><span class="caption-text">Five-point finite difference stencil</span><a class="headerlink" href="#fig-stencil" title="Permalink to this image">¶</a></p>
</div>
<p>Applying these finite differences gives us an approximation for Laplace’s equation:</p>
<div class="amsmath math notranslate nohighlight" id="equation-f031976e-2341-4533-846e-434af56ec098">
<span class="eqno">(5.6)<a class="headerlink" href="#equation-f031976e-2341-4533-846e-434af56ec098" title="Permalink to this equation">¶</a></span>\[\begin{equation}
\frac{u_{i-1,j} - 2u_{i,j} + u_{i+1,j}}{\Delta x^2} + \frac{u_{i,j-1} - 2u_{i,j} + u_{i,j+1}}{\Delta y^2} = 0 \;.
\end{equation}\]</div>
<p>If we use a uniform grid where <span class="math notranslate nohighlight">\(\Delta x = \Delta y = h\)</span>, then we can simplify to</p>
<div class="amsmath math notranslate nohighlight" id="equation-2f422df0-5c04-4d57-bc5d-421a65321e50">
<span class="eqno">(5.7)<a class="headerlink" href="#equation-2f422df0-5c04-4d57-bc5d-421a65321e50" title="Permalink to this equation">¶</a></span>\[\begin{equation}
u_{i+1,j} + u_{i,j+1} + u_{i-1,j} + u_{i,j-1} - 4 u_{i,j} = 0 \;.
\end{equation}\]</div>
<div class="section" id="example-heat-transfer-in-a-square-plate">
<h2><span class="section-number">5.1.1. </span>Example: heat transfer in a square plate<a class="headerlink" href="#example-heat-transfer-in-a-square-plate" title="Permalink to this headline">¶</a></h2>
<p>As an example, let’s consider the problem of steady-state heat transfer in a square solid object. If <span class="math notranslate nohighlight">\(u(x,y)\)</span> is temperature, then this is described by Laplace’s equation:</p>
<div class="amsmath math notranslate nohighlight" id="equation-12eef943-37ce-4b1b-bf38-2736b34cdb7e">
<span class="eqno">(5.8)<a class="headerlink" href="#equation-12eef943-37ce-4b1b-bf38-2736b34cdb7e" title="Permalink to this equation">¶</a></span>\[\begin{equation}
\frac{\partial^2 u}{\partial x^2} + \frac{\partial^2 u}{\partial y^2} = \nabla^2 u = 0 \;,
\end{equation}\]</div>
<p>and we can solve this using finite differences. Using a uniform grid where <span class="math notranslate nohighlight">\(\Delta x = \Delta y = h\)</span>, Laplace’s equation gives us a recursion formula that relates the values at neighboring points:</p>
<div class="amsmath math notranslate nohighlight" id="equation-9b739239-e5bc-4711-a004-f14e893f5d7a">
<span class="eqno">(5.9)<a class="headerlink" href="#equation-9b739239-e5bc-4711-a004-f14e893f5d7a" title="Permalink to this equation">¶</a></span>\[\begin{equation}
u_{i+1,j} + u_{i,j+1} + u_{i-1,j} + u_{i,j-1} - 4 u_{i,j} = 0 \;.
\end{equation}\]</div>
<p>Consider a case where the square has sides of length <span class="math notranslate nohighlight">\(L\)</span>, and the boundary conditions are that the temperature is fixed at 100 on the left, right, and bottom sides, and fixed at 0 on the top.
For now, we’ll use two segments to discretize the domain in each directions, giving us nine total points in the grid.
The following figures show the example problem, and the grid of points we’ll use.</p>
<div class="figure align-default" id="fig-heat-transfer-square">
<a class="bg-primary mb-1 reference internal image-reference" href="../../_images/heat-transfer-square.png"><img alt="Heat transfer in a square" class="bg-primary mb-1" src="../../_images/heat-transfer-square.png" style="width: 250px;" /></a>
<p class="caption"><span class="caption-number">Fig. 5.2 </span><span class="caption-text">Heat transfer in a square object</span><a class="headerlink" href="#fig-heat-transfer-square" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="fig-grid-three">
<a class="bg-primary mb-1 reference internal image-reference" href="../../_images/heat-equation-grid.png"><img alt="3x3 grid of points" class="bg-primary mb-1" src="../../_images/heat-equation-grid.png" style="width: 250px;" /></a>
<p class="caption"><span class="caption-number">Fig. 5.3 </span><span class="caption-text">Simple 3x3 grid of points</span><a class="headerlink" href="#fig-grid-three" title="Permalink to this image">¶</a></p>
</div>
<p>Using the above recursion formula, we can write an equation for each of the nine unknown points (in the interior, not the boundary points):</p>
<div class="amsmath math notranslate nohighlight" id="equation-3a6145fc-0b0a-4639-8db7-e9367476627f">
<span class="eqno">(5.10)<a class="headerlink" href="#equation-3a6145fc-0b0a-4639-8db7-e9367476627f" title="Permalink to this equation">¶</a></span>\[\begin{align}
u_{1,1} &amp;= 100 \\
u_{2,1} &amp;= 100 \\
u_{3,1} &amp;= 100 \\
u_{1,2} &amp;= 100 \\
\text{for } u_{2,2}: \quad u_{3,2} + u_{2,3} + u_{1,2} + u_{2,1} - 4u_{2,2} &amp;= 0 \\
u_{3,2} &amp;= 100 \\
u_{1,3} &amp;= 100 \\
u_{2,3} &amp;= 0 \\
u_{3,3} &amp;= 100
\end{align}\]</div>
<p>where <span class="math notranslate nohighlight">\(u_{i,j}\)</span> are the unknowns. Note that in this we used the side boundary condition values for the corner points <span class="math notranslate nohighlight">\(u_{1,3}\)</span> and <span class="math notranslate nohighlight">\(u_{3,3}\)</span>, rather than the top value. (In reality this would represent a discontinuity in temperature, so these aren’t very realistic boundary conditions.)</p>
<p>This is a system of linear equations, that we can represent as a matrix-vector product:</p>
<div class="amsmath math notranslate nohighlight" id="equation-5447889b-7a60-4f3d-886b-0e8af7066abb">
<span class="eqno">(5.11)<a class="headerlink" href="#equation-5447889b-7a60-4f3d-886b-0e8af7066abb" title="Permalink to this equation">¶</a></span>\[\begin{align}
\begin{bmatrix} 
1 &amp; 0 &amp; 0 &amp; 0 &amp;  0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 0 &amp;  0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; 0 &amp;  0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1 &amp;  0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 1 &amp; -4 &amp; 1 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp;  0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp;  0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp;  0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp;  0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 \\\end{bmatrix}
\begin{bmatrix} u_{1,1} \\ u_{2,1} \\ u_{3,1} \\ u_{1,2} \\ u_{2,2} \\ u_{3,2} \\ u_{1,3} \\ u_{2,3} \\ u_{3,3} \end{bmatrix} &amp;= 
\begin{bmatrix} 100 \\ 100 \\ 100 \\ 
100 \\ 0 \\ 100 \\
100 \\ 0 \\ 100 \end{bmatrix} \\
\text{or} \quad A \mathbf{u} &amp;= \mathbf{b}
\end{align}\]</div>
<p>where <span class="math notranslate nohighlight">\(A\)</span> is a <span class="math notranslate nohighlight">\(9\times 9\)</span> coefficient matrix, <span class="math notranslate nohighlight">\(\mathbf{u}\)</span> is a nine-element vector of unknown variables, and <span class="math notranslate nohighlight">\(\mathbf{b}\)</span> is a nine-element right-hand side vector.
For <span class="math notranslate nohighlight">\(\mathbf{u}\)</span>, we had to take variables that physically represent points in a two-dimensional space and combine them in some order to form a one-dimensional column vector. Here, we used a <strong>row-major</strong> mapping, where we started with the point in the first row and first column, then added the remaining points in that row, before moving to the next row and repeating. We’ll discuss this a bit more later.</p>
<p>If we set this up in Matlab, we can solve with <code class="docutils literal notranslate"><span class="pre">u</span> <span class="pre">=</span> <span class="pre">A</span> <span class="pre">\</span> <span class="pre">b</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">clear</span><span class="w"> </span><span class="nb">all</span><span class="p">;</span><span class="w"> </span><span class="n">clc</span><span class="w"></span>

<span class="s">A</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="n">1</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w">  </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="p">;</span><span class="w"></span>
<span class="n">0</span><span class="w"> </span><span class="s">1</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w">  </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="p">;</span><span class="w"></span>
<span class="n">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">1</span><span class="w"> </span><span class="s">0</span><span class="w">  </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="p">;</span><span class="w"></span>
<span class="n">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">1</span><span class="w">  </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="p">;</span><span class="w"></span>
<span class="n">0</span><span class="w"> </span><span class="s">1</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">1</span><span class="w"> </span><span class="o">-</span><span class="mi">4</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="n">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w">  </span><span class="s">0</span><span class="w"> </span><span class="s">1</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="p">;</span><span class="w"></span>
<span class="n">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w">  </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">1</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="p">;</span><span class="w"></span>
<span class="n">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w">  </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">1</span><span class="w"> </span><span class="s">0</span><span class="p">;</span><span class="w"></span>
<span class="n">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w">  </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">1]</span><span class="p">;</span><span class="w"></span>
<span class="n">b</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="mi">100</span><span class="p">];</span><span class="w"></span>

<span class="c">% solve system of linear equations</span><span class="w"></span>
<span class="n">u</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">\</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>

<span class="nb">disp</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   100
   100
   100
   100
    75
   100
   100
     0
   100
</pre></div>
</div>
</div>
</div>
<p>This gives us the values for temperature at each of the nine points. In this example, we really only have one unknown temperature: <span class="math notranslate nohighlight">\(u_{2,2}\)</span>, located in the middle. Does the value given make sense? We can check by rearranging the recursion formula for Laplace’s equation:</p>
<div class="amsmath math notranslate nohighlight" id="equation-19387ed7-294b-487d-b114-53b4aaf6e8ae">
<span class="eqno">(5.12)<a class="headerlink" href="#equation-19387ed7-294b-487d-b114-53b4aaf6e8ae" title="Permalink to this equation">¶</a></span>\[\begin{equation}
u_{i,j} = \frac{u_{i+1,j} + u_{i,j+1} + u_{i-1,j} + u_{i,j-1}}{4} \;,
\end{equation}\]</div>
<p>which shows that in such problems the value of the middle point should be the average of the four surrounding points. This matches the value of 75 found above.</p>
<p>We can use a contour plot to visualize the results, though we’ll need to convert the one-dimensional solution array into a two-dimensional matrix to plot. The Matlab <code class="docutils literal notranslate"><span class="pre">reshape()</span></code> function can help us here: it reshapes an array into a matrix, by specifying the target number of desired columns and rows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Example of using the reshape function, with a simple array going from 1 to 10</span><span class="w"></span>

<span class="c">% We want to convert it into a matrix with 5 columns and 2 rows.</span><span class="w"></span>
<span class="c">% The expected output is:</span><span class="w"></span>
<span class="c">% [1 2 3 4 5; </span><span class="w"></span>
<span class="c">%  6 7 8 9 10]</span><span class="w"></span>

<span class="n">b</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="o">&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">A</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]);</span><span class="w"></span>
<span class="nb">disp</span><span class="p">(</span><span class="s">&#39;b array:&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">disp</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w"></span>
<span class="nb">disp</span><span class="p">(</span><span class="s">&#39;A matrix:&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">disp</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>b array:
     1
     2
     3
     4
     5
     6
     7
     8
     9
    10

A matrix:
     1     6
     2     7
     3     8
     4     9
     5    10
</pre></div>
</div>
</div>
</div>
<p>This behavior may be a bit unexpected, because <code class="docutils literal notranslate"><span class="pre">reshape()</span></code> uses a column-major mapping. We can fix this by taking the transpose of the resulting matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">disp</span><span class="p">(</span><span class="s">&#39;transpose of output matrix:&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">disp</span><span class="p">(</span><span class="n">A</span><span class="o">&#39;</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>transpose of output matrix:
     1     2     3     4     5
     6     7     8     9    10
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% We can use the reshape function to convert the calculated temperatures</span><span class="w"></span>
<span class="c">% into a 3x3 matrix:</span><span class="w"></span>

<span class="n">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
<span class="n">u_square</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">]);</span><span class="w"></span>

<span class="nb">contourf</span><span class="p">(</span><span class="n">u_square</span><span class="o">&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">colorbar</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/elliptic_8_0.png" src="../../_images/elliptic_8_0.png" />
</div>
</div>
<p>Overall that looks correct: the boundary conditions are right, and we see that the center is the average of the boundaries.</p>
<p>But, clearly only using nine points (with eight of those being boundary conditions) doesn’t give us a very good solution. To make this more accurate, we’ll need to use more points, which also means we need to automate the construction of the system of equations.</p>
</div>
<div class="section" id="row-major-mapping">
<h2><span class="section-number">5.1.2. </span>Row-major mapping<a class="headerlink" href="#row-major-mapping" title="Permalink to this headline">¶</a></h2>
<p>For a two-dimensional elliptic PDE like Laplace’s equation, we can generate a general recursion formula, but we need a way to take a grid of points where location is defined by row and column index and map these into a one-dimensional column vector, which has its own index.</p>
<p>The following figure shows a general 2D grid of points, with <span class="math notranslate nohighlight">\(n\)</span> number of columns in the <span class="math notranslate nohighlight">\(x\)</span> direction (using index <span class="math notranslate nohighlight">\(i\)</span>) and <span class="math notranslate nohighlight">\(m\)</span> number of rows in the <span class="math notranslate nohighlight">\(y\)</span> direction (using index <span class="math notranslate nohighlight">\(j\)</span>):</p>
<div class="figure align-default" id="fig-twodim-grid">
<a class="bg-primary mb-1 reference internal image-reference" href="../../_images/row-major.png"><img alt="2D grid of points" class="bg-primary mb-1" src="../../_images/row-major.png" style="width: 350px;" /></a>
<p class="caption"><span class="caption-number">Fig. 5.4 </span><span class="caption-text">2D grid of points with <em>n</em> columns and <em>m</em> columns.</span><a class="headerlink" href="#fig-twodim-grid" title="Permalink to this image">¶</a></p>
</div>
<p>We want to convert the rows and columns of <span class="math notranslate nohighlight">\(u_{i,j}\)</span> points defined by column and row index into a single column array using a different index, <span class="math notranslate nohighlight">\(k\)</span> (this choice is arbitrary):</p>
<div class="amsmath math notranslate nohighlight" id="equation-851bff44-af7d-4720-b401-c619cfd49e84">
<span class="eqno">(5.13)<a class="headerlink" href="#equation-851bff44-af7d-4720-b401-c619cfd49e84" title="Permalink to this equation">¶</a></span>\[\begin{equation}
\begin{bmatrix} u_{1,1} \\ u_{2,1} \\ u_{3,1} \\ \vdots \\ u_{n,1} \\
u_{1,2} \\ u_{2,2} \\ u_{3,2} \\ \vdots \\ u_{n, 2} \\ u_{1,3} \\ \vdots \\
u_{1,m} \\ u_{2,m} \\ \vdots \\ u_{n,m}
\end{bmatrix}
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(k\)</span> refers to the index used in that array.</p>
<p>To do this mapping, we can use this formula:</p>
<div class="amsmath math notranslate nohighlight" id="equation-6eaec149-0af2-41f9-bf30-bfedb68288de">
<span class="eqno">(5.14)<a class="headerlink" href="#equation-6eaec149-0af2-41f9-bf30-bfedb68288de" title="Permalink to this equation">¶</a></span>\[\begin{equation}
k_{i,j} = (j-1)n + i
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(k_{i,j}\)</span> refers to the 1D index <span class="math notranslate nohighlight">\(k\)</span> mapped from the 2D indices <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span>.</p>
<div class="figure align-default" id="id1">
<a class="bg-primary mb-1 reference internal image-reference" href="../../_images/heat-equation-grid.png"><img alt="3x3 grid of points" class="bg-primary mb-1" src="../../_images/heat-equation-grid.png" style="width: 250px;" /></a>
<p class="caption"><span class="caption-number">Fig. 5.5 </span><span class="caption-text">Simple 3x3 grid of points</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>For example, in this <span class="math notranslate nohighlight">\(3\times 3\)</span> grid, where <span class="math notranslate nohighlight">\(n=3\)</span> and <span class="math notranslate nohighlight">\(m=3\)</span>, consider the point where <span class="math notranslate nohighlight">\(i=2\)</span> and <span class="math notranslate nohighlight">\(j=2\)</span> (the point right in the center). Using our formula,</p>
<div class="amsmath math notranslate nohighlight" id="equation-89f700e9-f1f5-4622-bb58-46b86f9e50fe">
<span class="eqno">(5.15)<a class="headerlink" href="#equation-89f700e9-f1f5-4622-bb58-46b86f9e50fe" title="Permalink to this equation">¶</a></span>\[\begin{equation}
k_{2,2} = (2-1)3 + 2 = 5
\end{equation}\]</div>
<p>which matches what we can visually confirm.</p>
<p>Using that mapping, we can also identify the 1D indices associated with the points surrounding location <span class="math notranslate nohighlight">\((i,j)\)</span>:</p>
<div class="amsmath math notranslate nohighlight" id="equation-0432bd6d-cbfb-4d46-924b-ed7f89a028c8">
<span class="eqno">(5.16)<a class="headerlink" href="#equation-0432bd6d-cbfb-4d46-924b-ed7f89a028c8" title="Permalink to this equation">¶</a></span>\[\begin{align}
k_{i-1,j} &amp;= (j-1)n + i - 1 \\
k_{i+1,j} &amp;= (j-1)n + i + 1 \\
k_{i,j-1} &amp;= (j-2)n + i \\
k_{i,j+1} &amp;= j n + i
\end{align}\]</div>
<p>which we can use to determine the appropriate locations to place values in the coefficient and right-hand side matrices.</p>
</div>
<div class="section" id="example-heat-transfer-in-a-square-plate-redux">
<h2><span class="section-number">5.1.3. </span>Example: heat transfer in a square plate (redux)<a class="headerlink" href="#example-heat-transfer-in-a-square-plate-redux" title="Permalink to this headline">¶</a></h2>
<p>Let’s return to the example of steady-state heat transfer in a square plate—but this time we’ll set the solution up more generally so we can vary the step size <span class="math notranslate nohighlight">\(h = \Delta x = \Delta y\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">clear</span><span class="p">;</span><span class="w"> </span><span class="nb">clc</span><span class="p">;</span><span class="w"> </span><span class="n">close</span><span class="w"> </span><span class="s">all</span><span class="w"></span>

<span class="n">h</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.1</span><span class="p">;</span><span class="w"></span>
<span class="n">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="n">y</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">y</span><span class="p">);</span><span class="w"></span>

<span class="c">% The coefficient matrix A is now m*n by m*n, since that is the total number of points.</span><span class="w"></span>
<span class="c">% The right-hand side vector b is m*n by 1.</span><span class="w"></span>
<span class="n">A</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">);</span><span class="w"></span>
<span class="n">b</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>

<span class="n">u_left</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"></span>
<span class="n">u_right</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"></span>
<span class="n">u_bottom</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"></span>
<span class="n">u_top</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="k">for</span><span class="w"> </span><span class="nb">j</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">m</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">n</span><span class="w"></span>
<span class="w">        </span><span class="c">% for convenience we calculate all the indices once</span><span class="w"></span>
<span class="w">        </span><span class="n">kij</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">kim1j</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">kip1j</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">kijm1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">kijp1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">j</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span>
<span class="w">            </span><span class="c">% this is the left boundary</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">b</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">u_left</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">elseif</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">n</span><span class="w"> </span>
<span class="w">            </span><span class="c">% right boundary</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">b</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">u_right</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">elseif</span><span class="w"> </span><span class="nb">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span>
<span class="w">            </span><span class="c">% bottom boundary</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">b</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">u_bottom</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">elseif</span><span class="w"> </span><span class="nb">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">m</span><span class="w"> </span>
<span class="w">            </span><span class="c">% top boundary</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">b</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">u_top</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"></span>
<span class="w">            </span><span class="c">% these are the coefficients for the interior points,</span><span class="w"></span>
<span class="w">            </span><span class="c">% based on the recursion formula</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kim1j</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kip1j</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kijm1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kijp1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
<span class="n">u</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">\</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>

<span class="n">u_square</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">]);</span><span class="w"></span>
<span class="nb">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">u_square</span><span class="o">&#39;</span><span class="p">)</span><span class="w"></span>
<span class="n">c</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">colorbar</span><span class="p">;</span><span class="w"></span>
<span class="n">c</span><span class="p">.</span><span class="n">Label</span><span class="p">.</span><span class="n">String</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Temperature&#39;</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/elliptic_12_0.png" src="../../_images/elliptic_12_0.png" />
</div>
</div>
</div>
<div class="section" id="neumann-derivative-boundary-conditions">
<h2><span class="section-number">5.1.4. </span>Neumann (derivative) boundary conditions<a class="headerlink" href="#neumann-derivative-boundary-conditions" title="Permalink to this headline">¶</a></h2>
<p>So far, we have only discussed cases where we have Dirichlet boundary conditions; in other words, when we have all fixed values at the boundary. Frequently we also encounter Neumann-style boundary conditions, where we have the <em>derivative</em> specified at the boundary.</p>
<p>We can handle this in the same way we do for one-dimensional boundary value problems: either with a forward or backward difference (both of which are first-order accurate), or with a central difference using an imaginary point/ghost node (which is second-order accurate). Let’s focus on using the central difference, since it is more accurate.</p>
<div class="figure align-default" id="fig-ghost-node">
<a class="bg-primary mb-1 reference internal image-reference" href="../../_images/2d-ghost-node.png"><img alt="ghost node at boundary" class="bg-primary mb-1" src="../../_images/2d-ghost-node.png" style="width: 250px;" /></a>
<p class="caption"><span class="caption-number">Fig. 5.6 </span><span class="caption-text">Ghost/imaginary node beyond an upper boundary</span><a class="headerlink" href="#fig-ghost-node" title="Permalink to this image">¶</a></p>
</div>
<p>For example, let’s say that at the upper boundary, the derivative of temperature is zero:</p>
<div class="amsmath math notranslate nohighlight" id="equation-c79e7aae-6130-4b73-8375-5faab4758348">
<span class="eqno">(5.17)<a class="headerlink" href="#equation-c79e7aae-6130-4b73-8375-5faab4758348" title="Permalink to this equation">¶</a></span>\[\begin{equation}
\left. \frac{\partial u}{\partial y} \right|_{\text{boundary}} = 0
\end{equation}\]</div>
<p>Let’s consider this boundary condition applied at the point shown, <span class="math notranslate nohighlight">\(u_{2,3}\)</span>.
We can approximate this derivative using a central difference:</p>
<div class="amsmath math notranslate nohighlight" id="equation-fd3de08e-02b3-4984-b280-8821e0299cd5">
<span class="eqno">(5.18)<a class="headerlink" href="#equation-fd3de08e-02b3-4984-b280-8821e0299cd5" title="Permalink to this equation">¶</a></span>\[\begin{align}
\frac{u_{2,3}}{\partial y} \approx \frac{u_{2,4} - u_{2,2}}{\Delta x} &amp;= 0 \\
u_{2,4} &amp;= u_{2,2}
\end{align}\]</div>
<p>This tells us the value of the point above the boundary, <span class="math notranslate nohighlight">\(u_{2,4}\)</span>; however, this point is a “ghost” or imaginary point located outside the boundary, so we don’t really care about its value. Instead, we can use this relationship to give us a usable equation for the boundary point, by incorporating it into the normal recursion formula for Laplace’s equation:</p>
<div class="amsmath math notranslate nohighlight" id="equation-9bd7ddab-73e4-4f7d-8498-d6dc03a07137">
<span class="eqno">(5.19)<a class="headerlink" href="#equation-9bd7ddab-73e4-4f7d-8498-d6dc03a07137" title="Permalink to this equation">¶</a></span>\[\begin{align}
u_{1,3} + u_{3,3} + u_{2,4} + u_{2,2} - 4u_{2,3} &amp;= 0 \\
u_{1,3} + u_{3,3} + u_{2,2} + u_{2,2} - 4u_{2,3} &amp;= 0 \\
\rightarrow u_{1,3} + u_{3,3} + 2 u_{2,2} - 4u_{2,3} &amp;= 0
\end{align}\]</div>
<p>The recursion formula for points along the upper boundary would then become</p>
<div class="amsmath math notranslate nohighlight" id="equation-21f028ce-54c1-4dac-a235-640fbbe05795">
<span class="eqno">(5.20)<a class="headerlink" href="#equation-21f028ce-54c1-4dac-a235-640fbbe05795" title="Permalink to this equation">¶</a></span>\[\begin{equation}
u_{i+1,j} + u_{i-1,j} + 2 u_{i,j-1} - 4 u_{i,j} = 0 \;.
\end{equation}\]</div>
<p>Now let’s try solving the above example, but with <span class="math notranslate nohighlight">\(\frac{\partial u}{\partial y} = 0\)</span> at the top boundary and <span class="math notranslate nohighlight">\(u = 0\)</span> at the bottom boundary:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">clear</span><span class="p">;</span><span class="w"> </span><span class="nb">clc</span><span class="p">;</span><span class="w"> </span><span class="n">close</span><span class="w"> </span><span class="s">all</span><span class="w"></span>

<span class="n">h</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.1</span><span class="p">;</span><span class="w"></span>
<span class="n">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="n">y</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">y</span><span class="p">);</span><span class="w"></span>

<span class="c">% The coefficient matrix A is now m*n by m*n, since that is the total number of points.</span><span class="w"></span>
<span class="c">% The right-hand side vector b is m*n by 1.</span><span class="w"></span>
<span class="n">A</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">);</span><span class="w"></span>
<span class="n">b</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>

<span class="n">u_left</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"></span>
<span class="n">u_right</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"></span>
<span class="n">u_bottom</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="k">for</span><span class="w"> </span><span class="nb">j</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">m</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">n</span><span class="w"></span>
<span class="w">        </span><span class="c">% for convenience we calculate all the indices once</span><span class="w"></span>
<span class="w">        </span><span class="n">kij</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">kim1j</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">kip1j</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">kijm1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">kijp1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">j</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span>
<span class="w">            </span><span class="c">% this is the left boundary</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">b</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">u_left</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">elseif</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">n</span><span class="w"> </span>
<span class="w">            </span><span class="c">% right boundary</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">b</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">u_right</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">elseif</span><span class="w"> </span><span class="nb">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span>
<span class="w">            </span><span class="c">% bottom boundary</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">b</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">u_bottom</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">elseif</span><span class="w"> </span><span class="nb">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">m</span><span class="w"> </span>
<span class="w">            </span><span class="c">% top boundary, using the ghost node + recursion formula</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kim1j</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kip1j</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kijm1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"></span>
<span class="w">            </span><span class="c">% these are the coefficients for the interior points,</span><span class="w"></span>
<span class="w">            </span><span class="c">% based on the recursion formula</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kim1j</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kip1j</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kijm1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kijp1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
<span class="n">u</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">\</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>

<span class="n">u_square</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">]);</span><span class="w"></span>
<span class="c">% the &quot;20&quot; indicates the number of levels for the contour plot</span><span class="w"></span>
<span class="nb">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">u_square</span><span class="o">&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">);</span><span class="w"></span>
<span class="n">c</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">colorbar</span><span class="p">;</span><span class="w"></span>
<span class="n">c</span><span class="p">.</span><span class="n">Label</span><span class="p">.</span><span class="n">String</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Temperature&#39;</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/elliptic_14_0.png" src="../../_images/elliptic_14_0.png" />
</div>
</div>
</div>
<div class="section" id="iterative-solutions-for-very-large-problems">
<h2><span class="section-number">5.1.5. </span>Iterative solutions for (very) large problems<a class="headerlink" href="#iterative-solutions-for-very-large-problems" title="Permalink to this headline">¶</a></h2>
<p>So far, we’ve been able to solve our systems of linear equations in Matlab by using <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">A</span> <span class="pre">\</span> <span class="pre">b</span></code>, which directly finds the solution to the equation <span class="math notranslate nohighlight">\(A \mathbf{y} = \mathbf{b}\)</span>.</p>
<p>However, this approach will become very slow as the grid resolution (<span class="math notranslate nohighlight">\(h = \Delta x = \Delta y\)</span>) becomes smaller, and eventually unfeasable due to the associated computational requirements. First, let’s create a function that takes as input the segment size <span class="math notranslate nohighlight">\(h\)</span>, then returns the time ittakes to solve the problem for different sizes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">%%file heat_equation.m</span><span class="w"></span>
<span class="k">function</span><span class="w"> </span><span class="nf">[time, num] = heat_equation</span><span class="p">(</span>h<span class="p">)</span><span class="w"></span>

<span class="n">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="n">y</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">y</span><span class="p">);</span><span class="w"></span>

<span class="c">% The coefficient matrix A is now m*n by m*n, since that is the total number of points.</span><span class="w"></span>
<span class="c">% The right-hand side vector b is m*n by 1.</span><span class="w"></span>
<span class="n">A</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">);</span><span class="w"></span>
<span class="n">b</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>

<span class="n">num</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="c">% number of points</span><span class="w"></span>

<span class="nb">tic</span><span class="p">;</span><span class="w"></span>

<span class="n">u_left</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"></span>
<span class="n">u_right</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"></span>
<span class="n">u_bottom</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"></span>
<span class="n">u_top</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="k">for</span><span class="w"> </span><span class="nb">j</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">m</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">n</span><span class="w"></span>
<span class="w">        </span><span class="c">% for convenience we calculate all the indices once</span><span class="w"></span>
<span class="w">        </span><span class="n">kij</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">kim1j</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">kip1j</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">kijm1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">kijp1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">j</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span>
<span class="w">            </span><span class="c">% this is the left boundary</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">b</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">u_left</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">elseif</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">n</span><span class="w"> </span>
<span class="w">            </span><span class="c">% right boundary</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">b</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">u_right</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">elseif</span><span class="w"> </span><span class="nb">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span>
<span class="w">            </span><span class="c">% bottom boundary</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">b</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">u_bottom</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">elseif</span><span class="w"> </span><span class="nb">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">m</span><span class="w"> </span>
<span class="w">            </span><span class="c">% top boundary</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">b</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">u_top</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"></span>
<span class="w">            </span><span class="c">% these are the coefficients for the interior points,</span><span class="w"></span>
<span class="w">            </span><span class="c">% based on the recursion formula</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kim1j</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kip1j</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kijm1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kijp1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span><span class="w"> </span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
<span class="n">u</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">\</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>

<span class="n">u_square</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">]);</span><span class="w"></span>
<span class="c">% the &quot;20&quot; indicates the number of levels for the contour plot</span><span class="w"></span>
<span class="c">%contourf(x, y, u_square&#39;, 20);</span><span class="w"></span>
<span class="c">%c = colorbar;</span><span class="w"></span>
<span class="c">%c.Label.String = &#39;Temperature&#39;;</span><span class="w"></span>

<span class="nb">time</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">toc</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Created file &#39;/Users/kyle/projects/ME373-book/content/pdes/heat_equation.m&#39;.
</pre></div>
</div>
</div>
</div>
<p>Now, we can see how long it takes to solve as we increase the resolution, and get an idea about the relationship between time-to-solution and number of unknowns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">clear</span><span class="w"> </span><span class="nb">all</span><span class="p">;</span><span class="w"> </span><span class="nb">clc</span><span class="p">;</span><span class="w"></span>

<span class="n">step_sizes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05</span><span class="p">,</span><span class="w"> </span><span class="mf">0.025</span><span class="p">,</span><span class="w"> </span><span class="mf">0.02</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0125</span><span class="p">,</span><span class="w"> </span><span class="mf">0.01</span><span class="p">];</span><span class="w"></span>

<span class="n">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">step_sizes</span><span class="p">);</span><span class="w"></span>
<span class="n">nums</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>

<span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">n</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">times</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span><span class="w"> </span><span class="n">nums</span><span class="p">(</span><span class="nb">i</span><span class="p">)]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">heat_equation</span><span class="p">(</span><span class="n">step_sizes</span><span class="p">(</span><span class="nb">i</span><span class="p">));</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="nb">loglog</span><span class="p">(</span><span class="n">nums</span><span class="p">,</span><span class="w"> </span><span class="n">times</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;-o&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;Number of unknowns&#39;</span><span class="p">);</span><span class="w"> </span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;Time for direct solution (sec)&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">hold</span><span class="w"> </span><span class="n">on</span><span class="w"></span>

<span class="n">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">nums</span><span class="p">(</span><span class="mi">3</span><span class="p">:</span><span class="k">end</span><span class="p">);</span><span class="w"></span>
<span class="n">n2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">x</span><span class="o">.^</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">times</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>^<span class="mi">2</span><span class="p">);</span><span class="w"></span>
<span class="n">n3</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">x</span><span class="o">.^</span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">times</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>^<span class="mi">3</span><span class="p">);</span><span class="w"></span>
<span class="nb">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">n2</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;-x&#39;</span><span class="p">);</span><span class="w"></span>
<span class="nb">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">n3</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;-s&#39;</span><span class="p">);</span><span class="w"></span>
<span class="nb">legend</span><span class="p">(</span><span class="s">&#39;Actual cost&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Quadratic cost&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Cubic cost&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Location&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;northwest&#39;</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/elliptic_18_0.png" src="../../_images/elliptic_18_0.png" />
</div>
</div>
<p>Interestingly, we see that the slope in this log-log plot that after about 400 unknowns (so a coefficient matrix of  about 160,000), the cost begins to increase exponentially, somewhere between quadratic (<span class="math notranslate nohighlight">\(\mathcal{O}(n^2)\)</span>) and cubic (<span class="math notranslate nohighlight">\(\mathcal{O}(n^3)\)</span>).</p>
<p>If we try to reduce the step size further, for example to 0.005, we’ll see that we cannot get a solution in a reasonable amount of time. But, clearly we want to get solutions for large numbers of unknowns, so what can we do?</p>
<p>We can solve larger systems of linear equations using <em>iterative</em> methods. There are a number of these, and we’ll focus on two:</p>
<ul class="simple">
<li><p>Jacobi method</p></li>
<li><p>Gauss-Seidel method</p></li>
</ul>
<div class="section" id="jacobi-method">
<h3><span class="section-number">5.1.5.1. </span>Jacobi method<a class="headerlink" href="#jacobi-method" title="Permalink to this headline">¶</a></h3>
<p>The Jacobi method essentially works by starting with an initial guess to the solution, then using the recursion formula to solve for values at each point, then repeating this until the values converge (i.e., stop changing).</p>
<p>An algorithm we can use to solve Laplace’s equation:</p>
<ol class="simple">
<li><p>Set some initial guess for all unknowns: <span class="math notranslate nohighlight">\(u_{i,j}^{\text{old}}\)</span></p></li>
<li><p>Set the boundary values</p></li>
<li><p>For each point in the interior, use the recursion formula to solve for new values based on old values at the surrounding points: <span class="math notranslate nohighlight">\(u_{i,j} = \left( u_{i+1,j}^{\text{old}} + u_{i-1,j}^{\text{old}} + u_{i,j+1}^{\text{old}} + u_{i,j-1}^{\text{old}} \right)/4\)</span>.</p></li>
<li><p>Check for convergence: is <span class="math notranslate nohighlight">\(\epsilon\)</span> less than some tolerance, such as <span class="math notranslate nohighlight">\(10^{-6}\)</span>? Where <span class="math notranslate nohighlight">\(\epsilon = \max \left| u_{i,j} - u_{i,j}^{\text{old}} \right|\)</span>. If no, then return to step 2 and repeat.</p></li>
</ol>
<p>More formally, if we have a system <span class="math notranslate nohighlight">\(A \mathbf{x} = \mathbf{b}\)</span>, where</p>
<div class="amsmath math notranslate nohighlight" id="equation-2fe3eec1-5d17-44da-8a56-ea193c11cc27">
<span class="eqno">(5.21)<a class="headerlink" href="#equation-2fe3eec1-5d17-44da-8a56-ea193c11cc27" title="Permalink to this equation">¶</a></span>\[\begin{equation}
A = \begin{bmatrix}
a_{11} &amp; a_{12} &amp; \cdots &amp; a_{1n} \\
a_{21} &amp; a_{22} &amp; \cdots &amp; a_{2n} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
a_{n1} &amp; a_{n2} &amp; \cdots &amp; a_{nn} \end{bmatrix}
\quad \mathbf{x} = \begin{bmatrix} x_1 \\ x_2 \\ \vdots \\ x_n \end{bmatrix}
\quad \mathbf{b} = \begin{bmatrix} b_1 \\ b_2 \\ \vdots \\ b_n \end{bmatrix}
\end{equation}\]</div>
<p>then we can solve iterative for <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> using</p>
<div class="amsmath math notranslate nohighlight" id="equation-14c58e9e-0be4-4f24-a3cb-afc3ee60759e">
<span class="eqno">(5.22)<a class="headerlink" href="#equation-14c58e9e-0be4-4f24-a3cb-afc3ee60759e" title="Permalink to this equation">¶</a></span>\[\begin{equation}
x_i^{(k+1)} = \frac{1}{a_{ii}} \left( b_i - \sum_{j \neq i} a_{ij} x_j^{(k)} \right) , \quad i = 1,2,\ldots, n 
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(x_i^{(k)}\)</span> is a value of the solution at iteration <span class="math notranslate nohighlight">\(k\)</span> and <span class="math notranslate nohighlight">\(x_i^{(k+1)}\)</span> is at the next iteration.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">%%file heat_equation_jacobi.m</span><span class="w"></span>
<span class="k">function</span><span class="w"> </span><span class="nf">[time, num_point, num_iter] = heat_equation_jacobi</span><span class="p">(</span>h<span class="p">)</span><span class="w"></span>

<span class="n">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="n">y</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">y</span><span class="p">);</span><span class="w"></span>

<span class="c">% The coefficient matrix A is now m*n by m*n, since that is the total number of points.</span><span class="w"></span>
<span class="c">% The right-hand side vector b is m*n by 1.</span><span class="w"></span>
<span class="n">A</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">);</span><span class="w"></span>
<span class="n">b</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="n">num_point</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">;</span><span class="w"></span>

<span class="nb">tic</span><span class="p">;</span><span class="w"></span>

<span class="n">u_left</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"></span>
<span class="n">u_right</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"></span>
<span class="n">u_bottom</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"></span>
<span class="n">u_top</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c">% initial guess</span><span class="w"></span>
<span class="n">u</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="o">*</span><span class="nb">ones</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>

<span class="c">% dummy value for residual variable</span><span class="w"></span>
<span class="n">epsilon</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w"> </span>

<span class="n">num_iter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="k">while</span><span class="w"> </span><span class="n">epsilon</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1e-6</span><span class="w"></span>
<span class="w">    </span><span class="n">u_old</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">u</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span>
<span class="w">    </span><span class="n">epsilon</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nb">j</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">m</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">n</span><span class="w"></span>
<span class="w">            </span><span class="n">kij</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">kim1j</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">kip1j</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">kijm1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">kijp1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">j</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span>
<span class="w">                </span><span class="c">% this is the left boundary</span><span class="w"></span>
<span class="w">                </span><span class="n">u</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">u_left</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">elseif</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">n</span><span class="w"> </span>
<span class="w">                </span><span class="c">% right boundary</span><span class="w"></span>
<span class="w">                </span><span class="n">u</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">u_right</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">elseif</span><span class="w"> </span><span class="nb">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span>
<span class="w">                </span><span class="c">% bottom boundary</span><span class="w"></span>
<span class="w">                </span><span class="n">u</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">u_bottom</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">elseif</span><span class="w"> </span><span class="nb">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">m</span><span class="w"> </span>
<span class="w">                </span><span class="c">% top boundary</span><span class="w"></span>
<span class="w">                </span><span class="n">u</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">u_top</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">else</span><span class="w"></span>
<span class="w">                </span><span class="c">% interior points</span><span class="w"></span>
<span class="w">                </span><span class="n">u</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">u_old</span><span class="p">(</span><span class="n">kip1j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u_old</span><span class="p">(</span><span class="n">kim1j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u_old</span><span class="p">(</span><span class="n">kijm1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u_old</span><span class="p">(</span><span class="n">kijp1</span><span class="p">))</span><span class="o">/</span><span class="mf">4.0</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span>
<span class="w">    </span><span class="n">epsilon</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u_old</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="n">num_iter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">num_iter</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="n">u_square</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">]);</span><span class="w"></span>
<span class="c">% the &quot;20&quot; indicates the number of levels for the contour plot</span><span class="w"></span>
<span class="nb">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">u_square</span><span class="o">&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">);</span><span class="w"></span>
<span class="n">c</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">colorbar</span><span class="p">;</span><span class="w"></span>
<span class="n">c</span><span class="p">.</span><span class="n">Label</span><span class="p">.</span><span class="n">String</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Temperature&#39;</span><span class="p">;</span><span class="w"></span>

<span class="nb">time</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">toc</span><span class="p">;</span><span class="w"></span>
<span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Number of iterations: %d\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">num_iter</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Created file &#39;/Users/kyle/projects/ME373-book/content/pdes/heat_equation_jacobi.m&#39;.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">step_sizes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05</span><span class="p">,</span><span class="w"> </span><span class="mf">0.025</span><span class="p">,</span><span class="w"> </span><span class="mf">0.02</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0125</span><span class="p">,</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span><span class="w"> </span><span class="mf">0.005</span><span class="p">];</span><span class="w"></span>
<span class="n">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">step_sizes</span><span class="p">);</span><span class="w"></span>

<span class="n">nums_jac</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="n">times_jac</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="n">num_iter_jac</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>

<span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">n</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">times_jac</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span><span class="w"> </span><span class="n">nums_jac</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span><span class="w"> </span><span class="n">num_iter_jac</span><span class="p">(</span><span class="nb">i</span><span class="p">)]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">heat_equation_jacobi</span><span class="p">(</span><span class="n">step_sizes</span><span class="p">(</span><span class="nb">i</span><span class="p">));</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of iterations: 291
Number of iterations: 1061
Number of iterations: 3803
Number of iterations: 5717
Number of iterations: 13421
Number of iterations: 20067
Number of iterations: 69037
</pre></div>
</div>
<img alt="../../_images/elliptic_22_1.png" src="../../_images/elliptic_22_1.png" />
</div>
</div>
</div>
<div class="section" id="gauss-seidel-method">
<h3><span class="section-number">5.1.5.2. </span>Gauss-Seidel method<a class="headerlink" href="#gauss-seidel-method" title="Permalink to this headline">¶</a></h3>
<p>The Gauss-Seidel method is very similar to the Jacobi method, but with one important difference: rather than using all old values to calculate the new values, incorporate updated values as they are available. Because the method incorporates newer information more quickly, it tends to converge faster (meaning, with fewer iterations) than the Jacobi method.</p>
<p>Formally, if we have a system <span class="math notranslate nohighlight">\(A \mathbf{x} = \mathbf{b}\)</span>, where</p>
<div class="amsmath math notranslate nohighlight" id="equation-76eaf223-5b67-49bc-a1c4-76d96a6e39fd">
<span class="eqno">(5.23)<a class="headerlink" href="#equation-76eaf223-5b67-49bc-a1c4-76d96a6e39fd" title="Permalink to this equation">¶</a></span>\[\begin{equation}
A = \begin{bmatrix}
a_{11} &amp; a_{12} &amp; \cdots &amp; a_{1n} \\
a_{21} &amp; a_{22} &amp; \cdots &amp; a_{2n} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
a_{n1} &amp; a_{n2} &amp; \cdots &amp; a_{nn} \end{bmatrix}
\quad \mathbf{x} = \begin{bmatrix} x_1 \\ x_2 \\ \vdots \\ x_n \end{bmatrix}
\quad \mathbf{b} = \begin{bmatrix} b_1 \\ b_2 \\ \vdots \\ b_n \end{bmatrix}
\end{equation}\]</div>
<p>then we can solve iterative for <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> using</p>
<div class="amsmath math notranslate nohighlight" id="equation-635a9e18-19df-4530-8d7f-5b0704a5d667">
<span class="eqno">(5.24)<a class="headerlink" href="#equation-635a9e18-19df-4530-8d7f-5b0704a5d667" title="Permalink to this equation">¶</a></span>\[\begin{equation}
x_i^{(k+1)} = \frac{1}{a_{ii}} \left( b_i - \sum_{j=1}^{i-1} a_{ij} x_j^{(k+1)} - \sum_{j =i+1}^n a_{ij} x_j^{(k)} \right) , \quad i = 1,2,\ldots, n 
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(x_i^{(k)}\)</span> is a value of the solution at iteration <span class="math notranslate nohighlight">\(k\)</span> and <span class="math notranslate nohighlight">\(x_i^{(k+1)}\)</span> is at the next iteration.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">%%file heat_equation_gaussseidel.m</span><span class="w"></span>
<span class="k">function</span><span class="w"> </span><span class="nf">[time, num_point, num_iter] = heat_equation_gaussseidel</span><span class="p">(</span>h<span class="p">)</span><span class="w"></span>

<span class="n">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="n">y</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">y</span><span class="p">);</span><span class="w"></span>

<span class="c">% The coefficient matrix A is now m*n by m*n, since that is the total number of points.</span><span class="w"></span>
<span class="c">% The right-hand side vector b is m*n by 1.</span><span class="w"></span>
<span class="n">A</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">);</span><span class="w"></span>
<span class="n">b</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="n">num_point</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">;</span><span class="w"></span>

<span class="nb">tic</span><span class="p">;</span><span class="w"></span>

<span class="n">u_left</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"></span>
<span class="n">u_right</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"></span>
<span class="n">u_bottom</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"></span>
<span class="n">u_top</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c">% initial guess</span><span class="w"></span>
<span class="n">u</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="o">*</span><span class="nb">ones</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>

<span class="c">% dummy value for residual variable</span><span class="w"></span>
<span class="n">epsilon</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w"> </span>

<span class="n">num_iter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="k">while</span><span class="w"> </span><span class="n">epsilon</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1e-6</span><span class="w"></span>
<span class="w">    </span><span class="n">u_old</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">u</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span>
<span class="w">    </span><span class="n">epsilon</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nb">j</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">m</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">n</span><span class="w"></span>
<span class="w">            </span><span class="n">kij</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">kim1j</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">kip1j</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">kijm1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">kijp1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">j</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">i</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span>
<span class="w">                </span><span class="c">% this is the left boundary</span><span class="w"></span>
<span class="w">                </span><span class="n">u</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">u_left</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">elseif</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">n</span><span class="w"> </span>
<span class="w">                </span><span class="c">% right boundary</span><span class="w"></span>
<span class="w">                </span><span class="n">u</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">u_right</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">elseif</span><span class="w"> </span><span class="nb">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span>
<span class="w">                </span><span class="c">% bottom boundary</span><span class="w"></span>
<span class="w">                </span><span class="n">u</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">u_bottom</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">elseif</span><span class="w"> </span><span class="nb">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">m</span><span class="w"> </span>
<span class="w">                </span><span class="c">% top boundary</span><span class="w"></span>
<span class="w">                </span><span class="n">u</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">u_top</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">else</span><span class="w"></span>
<span class="w">                </span><span class="c">% interior points</span><span class="w"></span>
<span class="w">                </span><span class="n">u</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="n">kip1j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="n">kim1j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="n">kijm1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="n">kijp1</span><span class="p">))</span><span class="o">/</span><span class="mf">4.0</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span>
<span class="w">    </span><span class="n">epsilon</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u_old</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="n">num_iter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">num_iter</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="n">u_square</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">]);</span><span class="w"></span>
<span class="c">%% the &quot;20&quot; indicates the number of levels for the contour plot</span><span class="w"></span>
<span class="nb">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">u_square</span><span class="o">&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">);</span><span class="w"></span>
<span class="n">c</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">colorbar</span><span class="p">;</span><span class="w"></span>
<span class="n">c</span><span class="p">.</span><span class="n">Label</span><span class="p">.</span><span class="n">String</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Temperature&#39;</span><span class="p">;</span><span class="w"></span>

<span class="nb">time</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">toc</span><span class="p">;</span><span class="w"></span>
<span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Number of iterations: %d\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">num_iter</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Created file &#39;/Users/kyle/projects/ME373-book/content/pdes/heat_equation_gaussseidel.m&#39;.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">step_sizes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05</span><span class="p">,</span><span class="w"> </span><span class="mf">0.025</span><span class="p">,</span><span class="w"> </span><span class="mf">0.02</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0125</span><span class="p">,</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span><span class="w"> </span><span class="mf">0.005</span><span class="p">];</span><span class="w"></span>
<span class="n">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">step_sizes</span><span class="p">);</span><span class="w"></span>

<span class="n">nums_gs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="n">times_gs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="n">num_iter_gs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>

<span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">n</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">times_gs</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span><span class="w"> </span><span class="n">nums_gs</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span><span class="w"> </span><span class="n">num_iter_gs</span><span class="p">(</span><span class="nb">i</span><span class="p">)]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">heat_equation_gaussseidel</span><span class="p">(</span><span class="n">step_sizes</span><span class="p">(</span><span class="nb">i</span><span class="p">));</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="nb">loglog</span><span class="p">(</span><span class="n">nums</span><span class="p">,</span><span class="w"> </span><span class="n">times</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;-o&#39;</span><span class="p">);</span><span class="w"> </span><span class="n">hold</span><span class="w"> </span><span class="s">on</span><span class="w"></span>
<span class="nb">loglog</span><span class="p">(</span><span class="n">nums_jac</span><span class="p">,</span><span class="w"> </span><span class="n">times_jac</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;-^&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">loglog</span><span class="p">(</span><span class="n">nums_gs</span><span class="p">,</span><span class="w"> </span><span class="n">times_gs</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;-x&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;Number of unknowns&#39;</span><span class="p">);</span><span class="w"> </span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;Time for solution (sec)&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">legend</span><span class="p">(</span><span class="s">&#39;Direct solution&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Jacobi solution&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Gauss-Seidel solution&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Location&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;northwest&#39;</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of iterations: 156
Number of iterations: 564
Number of iterations: 2025
Number of iterations: 3048
Number of iterations: 7181
Number of iterations: 10762
Number of iterations: 37378
</pre></div>
</div>
<img alt="../../_images/elliptic_25_1.png" src="../../_images/elliptic_25_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">loglog</span><span class="p">(</span><span class="n">nums_jac</span><span class="p">,</span><span class="w"> </span><span class="n">num_iter_jac</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;-^&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">hold</span><span class="w"> </span><span class="n">on</span><span class="p">;</span><span class="w"></span>
<span class="nb">loglog</span><span class="p">(</span><span class="n">nums_gs</span><span class="p">,</span><span class="w"> </span><span class="n">num_iter_gs</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;-x&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;Number of unknowns&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;Number of iterations required&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">legend</span><span class="p">(</span><span class="s">&#39;Jacobi method&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Gauss-Seidel method&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Location&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;northwest&#39;</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/elliptic_26_0.png" src="../../_images/elliptic_26_0.png" />
</div>
</div>
<p>These results show us a few things:</p>
<ul class="simple">
<li><p>For very small problems, the direct solution method is faster.</p></li>
<li><p>For the heat equation, once we get to around 1000 unknowns, the methods perform similarly. Beyond this, the direct solution method becomes unreasonably slow, and even fails to solve in a reasonable time for a step size of 0.005.</p></li>
<li><p>The Gauss-Seidel method converges with around half the number of iterations than the Jacobi method.</p></li>
</ul>
<p>For larger, more-realistic problems, iterative solution methods like Jacobi and Gauss-Seidel are essential.</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "matlab"
        },
        kernelOptions: {
            kernelName: "matlab",
            path: "./content/pdes"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'matlab'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="partial-differential-equations.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title"><span class="section-number">5. </span>Partial Differential Equations</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="parabolic.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title"><span class="section-number">5.2. </span>Parabolic PDEs</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Kyle Niemeyer<br/>
        
          <div class="extra_footer">
            <p xmlns:dct="http://purl.org/dc/terms/" xmlns:cc="http://creativecommons.org/ns#" class="license-text"><a rel="cc:attributionURL" property="dct:title" href="https://github.com/kyleniemeyer/ME373-book">Mechanical Engineering Methods notes</a> by <span property="cc:attributionName">Kyle Niemeyer</span> is licensed under <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1" /><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1" /><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1" /></a></p>

          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>