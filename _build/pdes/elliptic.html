---
interact_link: content/pdes/elliptic.ipynb
kernel_name: matlab
kernel_path: content/pdes
has_widgets: false
title: |-
  Elliptic PDEs
pagenum: 18
prev_page:
  url: /pdes/partial-differential-equations.html
next_page:
  url: /quizzes/quiz2-IVPs.html
suffix: .ipynb
search: u j equation partial x y points boundary begin end frac where grid point delta using heat example align n laplaces solve figure center values solution method us index formula k transfer right value d square recursion well bmatrix row problems temperature style lets conditions mathbf dimensional column gauss seidel nabla equations img src images png alt width px figcaptionfigure figcaption nine text unknowns matrix elliptic pde left step difference h very vector b mapping set into columns m ghost jacobi shows also finite differences central used direction five stencil consider td above major only need array accurate vdots size

comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---

    <main class="jupyter-page">
    <div id="page-info"><div id="page-title">Elliptic PDEs</div>
</div>
    <div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The classic example of an elliptic PDE is <strong>Laplace's equation</strong> (yep, the same Laplace that gave us the Laplace transform), which in two dimensions for a variable $u(x,y)$ is
\begin{equation}
\frac{\partial^2 u}{\partial x^2} + \frac{\partial^2 u}{\partial y^2} = \nabla^2 u = 0 \;,
\end{equation}
where $\nabla$ is del, or nabla, and represents the gradient operator: $\nabla = \frac{\partial}{\partial x} + \frac{\partial}{\partial y}$.</p>
<p>Laplace's equation shows up in a number of physical problems, including heat transfer, fluid dynamics, and electrostatics. For example, the heat equation for conduction in two dimensions is
\begin{equation}
\frac{\partial u}{\partial t} = \alpha \left( \frac{\partial^2 u}{\partial x^2} + \frac{\partial^2 u}{\partial y^2} \right) \;,
\end{equation}
where $u(x,y,t)$ is temperature and $\alpha$ is thermal diffusivity. Steady-state heat transfer (meaning after any initial transient period) is then described by Laplace's equation.</p>
<p>A related elliptic PDE is <strong>Poisson's equation</strong>:
\begin{equation}
\nabla^2 u = f(x,y) \;,
\end{equation}
which also appears in multiple physical problems—most notably, when solving for pressure in the Navier–Stokes equations.</p>
<p>To numerically solve these equations, and any elliptic PDE, we can use finite differences, where we replace the continuous $x,y$ domain with a discrete grid of points. This is similar to what we did with boundary-value problems in one dimension—but now we have two dimensions.</p>
<p>To approximate the second derivatives in Laplace's equation, we can use central differences in both the $x$ and $y$ directions, applied around the $u_{i,j}$ point:
\begin{align}
\frac{\partial^2 u}{\partial x^2} &amp;\approx \frac{u_{i-1,j} - 2u_{i,j} + u_{i+1,j}}{\Delta x^2} \\
\frac{\partial^2 u}{\partial y^2} &amp;\approx \frac{u_{i,j-1} - 2u_{i,j} + u_{i,j+1}}{\Delta y^2}
\end{align}
where $i$ is the index used in the $x$ direction, $j$ is the index in the $y$ direction, and $\Delta x$ and $\Delta y$ are the step sizes in the $x$ and $y$ directions.
In other words, $x_i = (i-1) \Delta x$ and $y_j = (j-1) \Delta y$.</p>
<p>The following figure shows the points necessary to approximate the partial derivatives in the PDE at a location $(x_i, y_j)$, for a general 2D region. This is known as a <strong>five-point stencil</strong>:</p>
<figure>
  <center>
  <img src="../images/five-point-stencil.png" alt="five-point stencil" style="width: 350px;"/>
  <figcaption>Figure: Five-point finite difference stencil</figcaption>
  </center>
</figure><p>Applying these finite differences gives us an approximation for Laplace's equation:
\begin{equation}
\frac{u_{i-1,j} - 2u_{i,j} + u_{i+1,j}}{\Delta x^2} + \frac{u_{i,j-1} - 2u_{i,j} + u_{i,j+1}}{\Delta y^2} = 0 \;.
\end{equation}
If we use a uniform grid where $\Delta x = \Delta y = h$, then we can simplify to 
\begin{equation}
u_{i+1,j} + u_{i,j+1} + u_{i-1,j} + u_{i,j-1} - 4 u_{i,j} = 0 \;.
\end{equation}</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Example:-heat-transfer-in-a-square-plate">Example: heat transfer in a square plate<a class="anchor-link" href="#Example:-heat-transfer-in-a-square-plate"> </a></h2><p>As an example, let's consider the problem of steady-state heat transfer in a square solid object. If $u(x,y)$ is temperature, then this is described by Laplace's equation:
\begin{equation}
\frac{\partial^2 u}{\partial x^2} + \frac{\partial^2 u}{\partial y^2} = \nabla^2 u = 0 \;,
\end{equation}
and we can solve this using finite differences. Using a uniform grid where $\Delta x = \Delta y = h$, Laplace's equation gives us a recursion formula that relates the values at neighboring points:
\begin{equation}
u_{i+1,j} + u_{i,j+1} + u_{i-1,j} + u_{i,j-1} - 4 u_{i,j} = 0 \;.
\end{equation}</p>
<p>Consider a case where the square has sides of length $L$, and the boundary conditions are that the temperature is fixed at 100 on the left, right, and bottom sides, and fixed at 0 on the top.
For now, we'll use two segments to discretize the domain in each directions, giving us nine total points in the grid.
The following figures show the example problem, and the grid of points we'll use.</p>
<table><tr>
<td> 
    <figure><center>
        <img src="../images/heat-transfer-square.png" alt="Heat transfer in a square" style="width: 250px;"/> 
        <figcaption>Figure: Heat transfer in a square object</figcaption>
    </center></figure>
</td>
<td> 
    <figure><center>
        <img src="../images/heat-equation-grid.png" alt="3x3 grid of points" style="width: 250px;"/> 
        <figcaption>Figure: Simple 3x3 grid of points</figcaption>
    </center></figure>
</td>
</tr></table><p>Using the above recursion formula, we can write an equation for each of the nine unknown points (in the interior, not the boundary points):
\begin{align}
u_{1,1} &amp;= 100 \\
u_{2,1} &amp;= 100 \\
u_{3,1} &amp;= 100 \\
u_{1,2} &amp;= 100 \\
\text{for } u_{2,2}: \quad u_{3,2} + u_{2,3} + u_{1,2} + u_{2,1} - 4u_{2,2} &amp;= 0 \\
u_{3,2} &amp;= 100 \\
u_{1,3} &amp;= 100 \\
u_{2,3} &amp;= 0 \\
u_{3,3} &amp;= 100
\end{align}
where $u_{i,j}$ are the unknowns. Note that in this we used the side boundary condition values for the corner points $u_{1,3}$ and $u_{3,3}$, rather than the top value. (In reality this would represent a discontinuity in temperature, so these aren't very realistic boundary conditions.)</p>
<p>This is a system of linear equations, that we can represent as a matrix-vector product:
\begin{align}
\begin{bmatrix} 
1 &amp; 0 &amp; 0 &amp; 0 &amp;  0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 0 &amp;  0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; 0 &amp;  0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1 &amp;  0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 1 &amp; -4 &amp; 1 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp;  0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp;  0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp;  0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp;  0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 \\\end{bmatrix}
\begin{bmatrix} u_{1,1} \\ u_{2,1} \\ u_{3,1} \\ u_{1,2} \\ u_{2,2} \\ u_{3,2} \\ u_{1,3} \\ u_{2,3} \\ u_{3,3} \end{bmatrix} &amp;= 
\begin{bmatrix} 100 \\ 100 \\ 100 \\ 
100 \\ 0 \\ 100 \\
100 \\ 0 \\ 100 \end{bmatrix} \\
\text{or} \quad A \mathbf{u} &amp;= \mathbf{b}
\end{align}
where $A$ is a $9\times 9$ coefficient matrix, $\mathbf{u}$ is a nine-element vector of unknown variables, and $\mathbf{b}$ is a nine-element right-hand side vector.
For $\mathbf{u}$, we had to take variables that physically represent points in a two-dimensional space and combine them in some order to form a one-dimensional column vector. Here, we used a <strong>row-major</strong> mapping, where we started with the point in the first row and first column, then added the remaining points in that row, before moving to the next row and repeating. We'll discuss this a bit more later.</p>
<p>If we set this up in Matlab, we can solve with <code>u = A \ b</code>:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-matlab"><pre><span></span><span class="n">clear</span> <span class="n">all</span><span class="p">;</span> <span class="n">clc</span>

<span class="n">A</span> <span class="p">=</span> <span class="p">[</span>
<span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>  <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">;</span>
<span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span>  <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">;</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span>  <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">;</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span>  <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">;</span>
<span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span> <span class="o">-</span><span class="mi">4</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">;</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>  <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">;</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>  <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">;</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>  <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">;</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>  <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">];</span>
<span class="n">b</span> <span class="p">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">;</span> <span class="mi">100</span><span class="p">;</span> <span class="mi">100</span><span class="p">;</span> <span class="mi">100</span><span class="p">;</span> <span class="mi">0</span><span class="p">;</span> <span class="mi">100</span><span class="p">;</span> <span class="mi">100</span><span class="p">;</span> <span class="mi">0</span><span class="p">;</span> <span class="mi">100</span><span class="p">];</span>

<span class="c">% solve system of linear equations</span>
<span class="n">u</span> <span class="p">=</span> <span class="n">A</span> <span class="o">\</span> <span class="n">b</span><span class="p">;</span>

<span class="nb">disp</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>   100
   100
   100
   100
    75
   100
   100
     0
   100

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This gives us the values for temperature at each of the nine points. In this example, we really only have one unknown temperature: $u_{2,2}$, located in the middle. Does the value given make sense? We can check by rearranging the recursion formula for Laplace's equation:
\begin{equation}
u_{i,j} = \frac{u_{i+1,j} + u_{i,j+1} + u_{i-1,j} + u_{i,j-1}}{4} \;,
\end{equation}
which shows that in such problems the value of the middle point should be the average of the four surrounding points. This matches the value of 75 found above.</p>
<p>We can use a contour plot to visualize the results, though we'll need to convert the one-dimensional solution array into a two-dimensional matrix to plot. The Matlab <code>reshape()</code> function can help us here: it reshapes an array into a matrix, by specifying the target number of desired columns and rows:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-matlab"><pre><span></span><span class="c">% Example of using the reshape function, with a simple array going from 1 to 10</span>

<span class="c">% We want to convert it into a matrix with 5 columns and 2 rows.</span>
<span class="c">% The expected output is:</span>
<span class="c">% [1 2 3 4 5; </span>
<span class="c">%  6 7 8 9 10]</span>

<span class="n">b</span> <span class="p">=</span> <span class="p">(</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">10</span><span class="p">)</span><span class="o">&#39;</span><span class="p">;</span>
<span class="n">A</span> <span class="p">=</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">]);</span>
<span class="nb">disp</span><span class="p">(</span><span class="s">&#39;b array:&#39;</span><span class="p">)</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="nb">disp</span><span class="p">(</span><span class="s">&#39;A matrix:&#39;</span><span class="p">)</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>b array:
     1
     2
     3
     4
     5
     6
     7
     8
     9
    10

A matrix:
     1     6
     2     7
     3     8
     4     9
     5    10

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This behavior may be a bit unexpected, because <code>reshape()</code> uses a column-major mapping. We can fix this by taking the transpose of the resulting matrix:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-matlab"><pre><span></span><span class="nb">disp</span><span class="p">(</span><span class="s">&#39;transpose of output matrix:&#39;</span><span class="p">)</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">A</span><span class="o">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>transpose of output matrix:
     1     2     3     4     5
     6     7     8     9    10

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-matlab"><pre><span></span><span class="c">% We can use the reshape function to convert the calculated temperatures</span>
<span class="c">% into a 3x3 matrix:</span>

<span class="n">n</span> <span class="p">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">m</span> <span class="p">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="n">u_square</span> <span class="p">=</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">]);</span>

<span class="n">contourf</span><span class="p">(</span><span class="n">u_square</span><span class="o">&#39;</span><span class="p">)</span>
<span class="n">colorbar</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/pdes/elliptic_7_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Overall that looks correct: the boundary conditions are right, and we see that the center is the average of the boundaries.</p>
<p>But, clearly only using nine points (with eight of those being boundary conditions) doesn't give us a very good solution. To make this more accurate, we'll need to use more points, which also means we need to automate the construction of the system of equations.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Row-major-mapping">Row-major mapping<a class="anchor-link" href="#Row-major-mapping"> </a></h2><p>For a two-dimensional elliptic PDE like Laplace's equation, we can generate a general recursion formula, but we need a way to take a grid of points where location is defined by row and column index and map these into a one-dimensional column vector, which has its own index.</p>
<p>The following figure shows a general 2D grid of points, with $n$ number of columns in the $x$ direction (using index $i$) and $m$ number of rows in the $y$ direction (using index $j$):</p>
<figure>
  <center>
  <img src="../images/row-major.png" alt="2D grid of points" style="width: 350px;"/>
      <figcaption>Figure: 2D grid of points with <i>n</i> columns and <i>m</i> columns.</figcaption>
  </center>
</figure><p>We want to convert the rows and columns of $u_{i,j}$ points defined by column and row index into a single column array using a different index, $k$ (this choice is arbitrary):
\begin{equation}
\begin{bmatrix} u_{1,1} \\ u_{2,1} \\ u_{3,1} \\ \vdots \\ u_{n,1} \\
u_{1,2} \\ u_{2,2} \\ u_{3,2} \\ \vdots \\ u_{n, 2} \\ u_{1,3} \\ \vdots \\
u_{1,m} \\ u_{2,m} \\ \vdots \\ u_{n,m}
\end{bmatrix}
\end{equation}
where $k$ refers to the index used in that array.</p>
<p>To do this mapping, we can use this formula:
\begin{equation}
k_{i,j} = (j-1)n + i
\end{equation}
where $k_{i,j}$ refers to the 1D index $k$ mapped from the 2D indices $i$ and $j$.</p>
<figure><center>
    <img src="../images/heat-equation-grid.png" alt="3x3 grid of points" style="width: 250px;"/> 
    <figcaption>Figure: Simple 3x3 grid of points</figcaption>
</center></figure><p>For example, in this $3\times 3$ grid, where $n=3$ and $m=3$, consider the point where $i=2$ and $j=2$ (the point right in the center). Using our formula, 
\begin{equation}
k_{2,2} = (2-1)3 + 2 = 5
\end{equation}
which matches what we can visually confirm.</p>
<p>Using that mapping, we can also identify the 1D indices associated with the points surrounding location $(i,j)$:
\begin{align}
k_{i-1,j} &amp;= (j-1)n + i - 1 \\
k_{i+1,j} &amp;= (j-1)n + i + 1 \\
k_{i,j-1} &amp;= (j-2)n + i \\
k_{i,j+1} &amp;= j n + i
\end{align}
which we can use to determine the appropriate locations to place values in the coefficient and right-hand side matrices.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Example:-heat-transfer-in-a-square-plate-(redux)">Example: heat transfer in a square plate (redux)<a class="anchor-link" href="#Example:-heat-transfer-in-a-square-plate-(redux)"> </a></h2><p>Let's return to the example of steady-state heat transfer in a square plate—but this time we'll set the solution up more generally so we can vary the step size $h = \Delta x = \Delta y$.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-matlab"><pre><span></span><span class="n">clear</span><span class="p">;</span> <span class="n">clc</span><span class="p">;</span> <span class="n">close</span> <span class="n">all</span>

<span class="n">h</span> <span class="p">=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="n">x</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">h</span> <span class="p">:</span> <span class="mi">1</span><span class="p">];</span> <span class="n">n</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="n">y</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">h</span> <span class="p">:</span> <span class="mi">1</span><span class="p">];</span> <span class="n">m</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>

<span class="c">% The coefficient matrix A is now m*n by m*n, since that is the total number of points.</span>
<span class="c">% The right-hand side vector b is m*n by 1.</span>
<span class="n">A</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">);</span>
<span class="n">b</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="n">u_left</span> <span class="p">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="n">u_right</span> <span class="p">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="n">u_bottom</span> <span class="p">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="n">u_top</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">for</span> <span class="nb">j</span> <span class="p">=</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">m</span>
    <span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">n</span>
        <span class="c">% for convenience we calculate all the indices once</span>
        <span class="n">kij</span> <span class="p">=</span> <span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span><span class="p">;</span>
        <span class="n">kim1j</span> <span class="p">=</span> <span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">kip1j</span> <span class="p">=</span> <span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">kijm1</span> <span class="p">=</span> <span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span><span class="p">;</span>
        <span class="n">kijp1</span> <span class="p">=</span> <span class="nb">j</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span><span class="p">;</span>
        
        <span class="k">if</span> <span class="nb">i</span> <span class="o">==</span> <span class="mi">1</span> 
            <span class="c">% this is the left boundary</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">b</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="n">u_left</span><span class="p">;</span>
        <span class="k">elseif</span> <span class="nb">i</span> <span class="o">==</span> <span class="n">n</span> 
            <span class="c">% right boundary</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">b</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="n">u_right</span><span class="p">;</span>
        <span class="k">elseif</span> <span class="nb">j</span> <span class="o">==</span> <span class="mi">1</span> 
            <span class="c">% bottom boundary</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">b</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="n">u_bottom</span><span class="p">;</span>
        <span class="k">elseif</span> <span class="nb">j</span> <span class="o">==</span> <span class="n">m</span> 
            <span class="c">% top boundary</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">b</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="n">u_top</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="c">% these are the coefficients for the interior points,</span>
            <span class="c">% based on the recursion formula</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kim1j</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kip1j</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kijm1</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kijp1</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="o">-</span><span class="mi">4</span><span class="p">;</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">u</span> <span class="p">=</span> <span class="n">A</span> <span class="o">\</span> <span class="n">b</span><span class="p">;</span>

<span class="n">u_square</span> <span class="p">=</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">]);</span>
<span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u_square</span><span class="o">&#39;</span><span class="p">)</span>
<span class="n">c</span> <span class="p">=</span> <span class="n">colorbar</span><span class="p">;</span>
<span class="n">c</span><span class="p">.</span><span class="n">Label</span><span class="p">.</span><span class="n">String</span> <span class="p">=</span> <span class="s">&#39;Temperature&#39;</span><span class="p">;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/pdes/elliptic_11_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Neumann-(derivative)-boundary-conditions">Neumann (derivative) boundary conditions<a class="anchor-link" href="#Neumann-(derivative)-boundary-conditions"> </a></h2><p>So far, we have only discussed cases where we have Dirichlet boundary conditions; in other words, when we have all fixed values at the boundary. Frequently we also encounter Neumann-style boundary conditions, where we have the <em>derivative</em> specified at the boundary.</p>
<p>We can handle this in the same way we do for one-dimensional boundary value problems: either with a forward or backward difference (both of which are first-order accurate), or with a central difference using an imaginary point/ghost node (which is second-order accurate). Let's focus on using the central difference, since it is more accurate.</p>
<figure>
  <center>
  <img src="../images/2d-ghost-node.png" alt="ghost node at boundary" style="width: 350px;"/>
  <figcaption>Figure: Ghost/imaginary node beyond an upper boundary</figcaption>
  </center>
</figure><p>For example, let's say that at the upper boundary, the derivative of temperature is zero:
\begin{equation}
\left. \frac{\partial u}{\partial y} \right|_{\text{boundary}} = 0
\end{equation}</p>
<p>Let's consider this boundary condition applied at the point shown, $u_{2,3}$.
We can approximate this derivative using a central difference:
\begin{align}
\frac{u_{2,3}}{\partial y} \approx \frac{u_{2,4} - u_{2,2}}{\Delta x} &amp;= 0 \\
u_{2,4} &amp;= u_{2,2}
\end{align}
This tells us the value of the point above the boundary, $u_{2,4}$; however, this point is a "ghost" or imaginary point located outside the boundary, so we don't really care about its value. Instead, we can use this relationship to give us a usable equation for the boundary point, by incorporating it into the normal recursion formula for Laplace's equation:
\begin{align}
u_{1,3} + u_{3,3} + u_{2,4} + u_{2,2} - 4u_{2,3} &amp;= 0 \\
u_{1,3} + u_{3,3} + u_{2,2} + u_{2,2} - 4u_{2,3} &amp;= 0 \\
\rightarrow u_{1,3} + u_{3,3} + 2 u_{2,2} - 4u_{2,3} &amp;= 0
\end{align}</p>
<p>The recursion formula for points along the upper boundary would then become
\begin{equation}
u_{i+1,j} + u_{i-1,j} + 2 u_{i,j-1} - 4 u_{i,j} = 0 \;.
\end{equation}</p>
<p>Now let's try solving the above example, but with $\frac{\partial u}{\partial y} = 0$ at the top boundary and $u = 0$ at the bottom boundary:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-matlab"><pre><span></span><span class="n">clear</span><span class="p">;</span> <span class="n">clc</span><span class="p">;</span> <span class="n">close</span> <span class="n">all</span>

<span class="n">h</span> <span class="p">=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="n">x</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">h</span> <span class="p">:</span> <span class="mi">1</span><span class="p">];</span> <span class="n">n</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="n">y</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">h</span> <span class="p">:</span> <span class="mi">1</span><span class="p">];</span> <span class="n">m</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>

<span class="c">% The coefficient matrix A is now m*n by m*n, since that is the total number of points.</span>
<span class="c">% The right-hand side vector b is m*n by 1.</span>
<span class="n">A</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">);</span>
<span class="n">b</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="n">u_left</span> <span class="p">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="n">u_right</span> <span class="p">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="n">u_bottom</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">for</span> <span class="nb">j</span> <span class="p">=</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">m</span>
    <span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">n</span>
        <span class="c">% for convenience we calculate all the indices once</span>
        <span class="n">kij</span> <span class="p">=</span> <span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span><span class="p">;</span>
        <span class="n">kim1j</span> <span class="p">=</span> <span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">kip1j</span> <span class="p">=</span> <span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">kijm1</span> <span class="p">=</span> <span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span><span class="p">;</span>
        <span class="n">kijp1</span> <span class="p">=</span> <span class="nb">j</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span><span class="p">;</span>
        
        <span class="k">if</span> <span class="nb">i</span> <span class="o">==</span> <span class="mi">1</span> 
            <span class="c">% this is the left boundary</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">b</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="n">u_left</span><span class="p">;</span>
        <span class="k">elseif</span> <span class="nb">i</span> <span class="o">==</span> <span class="n">n</span> 
            <span class="c">% right boundary</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">b</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="n">u_right</span><span class="p">;</span>
        <span class="k">elseif</span> <span class="nb">j</span> <span class="o">==</span> <span class="mi">1</span> 
            <span class="c">% bottom boundary</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">b</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="n">u_bottom</span><span class="p">;</span>
        <span class="k">elseif</span> <span class="nb">j</span> <span class="o">==</span> <span class="n">m</span> 
            <span class="c">% top boundary, using the ghost node + recursion formula</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kim1j</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kip1j</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kijm1</span><span class="p">)</span> <span class="p">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="o">-</span><span class="mi">4</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="c">% these are the coefficients for the interior points,</span>
            <span class="c">% based on the recursion formula</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kim1j</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kip1j</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kijm1</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kijp1</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="o">-</span><span class="mi">4</span><span class="p">;</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">u</span> <span class="p">=</span> <span class="n">A</span> <span class="o">\</span> <span class="n">b</span><span class="p">;</span>

<span class="n">u_square</span> <span class="p">=</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">]);</span>
<span class="c">% the &quot;20&quot; indicates the number of levels for the contour plot</span>
<span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u_square</span><span class="o">&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
<span class="n">c</span> <span class="p">=</span> <span class="n">colorbar</span><span class="p">;</span>
<span class="n">c</span><span class="p">.</span><span class="n">Label</span><span class="p">.</span><span class="n">String</span> <span class="p">=</span> <span class="s">&#39;Temperature&#39;</span><span class="p">;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/pdes/elliptic_13_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Iterative-solutions-for-(very)-large-problems">Iterative solutions for (very) large problems<a class="anchor-link" href="#Iterative-solutions-for-(very)-large-problems"> </a></h2><p>So far, we've been able to solve our systems of linear equations in Matlab by using <code>y = A \ b</code>, which directly finds the solution to the equation $A \mathbf{y} = \mathbf{b}$.</p>
<p>However, this approach will become very slow as the grid resolution ($h = \Delta x = \Delta y$) becomes smaller, and eventually unfeasable due to the associated computational requirements. First, let's create a function that takes as input the segment size $h$, then returns the time ittakes to solve the problem for different sizes.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-matlab"><pre><span></span><span class="c">%%file heat_equation.m</span>
<span class="k">function</span><span class="w"> </span>[time, num] <span class="p">=</span><span class="w"> </span><span class="nf">heat_equation</span><span class="p">(</span>h<span class="p">)</span><span class="w"></span>

<span class="n">x</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">h</span> <span class="p">:</span> <span class="mi">1</span><span class="p">];</span> <span class="n">n</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="n">y</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">h</span> <span class="p">:</span> <span class="mi">1</span><span class="p">];</span> <span class="n">m</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>

<span class="c">% The coefficient matrix A is now m*n by m*n, since that is the total number of points.</span>
<span class="c">% The right-hand side vector b is m*n by 1.</span>
<span class="n">A</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">);</span>
<span class="n">b</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="n">num</span> <span class="p">=</span> <span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">;</span> <span class="c">% number of points</span>

<span class="n">tic</span><span class="p">;</span>

<span class="n">u_left</span> <span class="p">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="n">u_right</span> <span class="p">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="n">u_bottom</span> <span class="p">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="n">u_top</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">for</span> <span class="nb">j</span> <span class="p">=</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">m</span>
    <span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">n</span>
        <span class="c">% for convenience we calculate all the indices once</span>
        <span class="n">kij</span> <span class="p">=</span> <span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span><span class="p">;</span>
        <span class="n">kim1j</span> <span class="p">=</span> <span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">kip1j</span> <span class="p">=</span> <span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">kijm1</span> <span class="p">=</span> <span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span><span class="p">;</span>
        <span class="n">kijp1</span> <span class="p">=</span> <span class="nb">j</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span><span class="p">;</span>
        
        <span class="k">if</span> <span class="nb">i</span> <span class="o">==</span> <span class="mi">1</span> 
            <span class="c">% this is the left boundary</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">b</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="n">u_left</span><span class="p">;</span>
        <span class="k">elseif</span> <span class="nb">i</span> <span class="o">==</span> <span class="n">n</span> 
            <span class="c">% right boundary</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">b</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="n">u_right</span><span class="p">;</span>
        <span class="k">elseif</span> <span class="nb">j</span> <span class="o">==</span> <span class="mi">1</span> 
            <span class="c">% bottom boundary</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">b</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="n">u_bottom</span><span class="p">;</span>
        <span class="k">elseif</span> <span class="nb">j</span> <span class="o">==</span> <span class="n">m</span> 
            <span class="c">% top boundary</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">b</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="n">u_top</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="c">% these are the coefficients for the interior points,</span>
            <span class="c">% based on the recursion formula</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kim1j</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kip1j</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kijm1</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kijp1</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">A</span><span class="p">(</span><span class="n">kij</span><span class="p">,</span> <span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="o">-</span><span class="mi">4</span><span class="p">;</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">u</span> <span class="p">=</span> <span class="n">A</span> <span class="o">\</span> <span class="n">b</span><span class="p">;</span>

<span class="n">u_square</span> <span class="p">=</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">]);</span>
<span class="c">% the &quot;20&quot; indicates the number of levels for the contour plot</span>
<span class="c">%contourf(x, y, u_square&#39;, 20);</span>
<span class="c">%c = colorbar;</span>
<span class="c">%c.Label.String = &#39;Temperature&#39;;</span>

<span class="n">time</span> <span class="p">=</span> <span class="n">toc</span><span class="p">;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Created file &#39;/Users/kyle/projects/ME373-book/content/pdes/heat_equation.m&#39;.
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, we can see how long it takes to solve as we increase the resolution, and get an idea about the relationship between time-to-solution and number of unknowns.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-matlab"><pre><span></span><span class="n">clear</span> <span class="n">all</span><span class="p">;</span> <span class="n">clc</span><span class="p">;</span>

<span class="n">step_sizes</span> <span class="p">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.0125</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">];</span>

<span class="n">n</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">step_sizes</span><span class="p">);</span>
<span class="n">nums</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="n">times</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

<span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">n</span>
    <span class="p">[</span><span class="n">times</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span> <span class="n">nums</span><span class="p">(</span><span class="nb">i</span><span class="p">)]</span> <span class="p">=</span> <span class="n">heat_equation</span><span class="p">(</span><span class="n">step_sizes</span><span class="p">(</span><span class="nb">i</span><span class="p">));</span>
<span class="k">end</span>

<span class="n">loglog</span><span class="p">(</span><span class="n">nums</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="s">&#39;-o&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Number of unknowns&#39;</span><span class="p">);</span> 
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Time for direct solution (sec)&#39;</span><span class="p">)</span>
<span class="n">hold</span> <span class="n">on</span>

<span class="n">x</span> <span class="p">=</span> <span class="n">nums</span><span class="p">(</span><span class="mi">3</span><span class="p">:</span><span class="k">end</span><span class="p">);</span>
<span class="n">n2</span> <span class="p">=</span> <span class="n">x</span><span class="o">.^</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">times</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>^<span class="mi">2</span><span class="p">);</span>
<span class="n">n3</span> <span class="p">=</span> <span class="n">x</span><span class="o">.^</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">times</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>^<span class="mi">3</span><span class="p">);</span>
<span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="s">&#39;-x&#39;</span><span class="p">);</span>
<span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="s">&#39;-s&#39;</span><span class="p">);</span>
<span class="n">legend</span><span class="p">(</span><span class="s">&#39;Actual cost&#39;</span><span class="p">,</span> <span class="s">&#39;Quadratic cost&#39;</span><span class="p">,</span> <span class="s">&#39;Cubic cost&#39;</span><span class="p">,</span> <span class="s">&#39;Location&#39;</span><span class="p">,</span> <span class="s">&#39;northwest&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/pdes/elliptic_17_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Interestingly, we see that the slope in this log-log plot that after about 400 unknowns (so a coefficient matrix of  about 160,000), the cost begins to increase exponentially, somewhere between quadratic ($\mathcal{O}(n^2)$) and cubic ($\mathcal{O}(n^3)$).</p>
<p>If we try to reduce the step size further, for example to 0.005, we'll see that we cannot get a solution in a reasonable amount of time. But, clearly we want to get solutions for large numbers of unknowns, so what can we do?</p>
<p>We can solve larger systems of linear equations using <em>iterative</em> methods. There are a number of these, and we'll focus on two:</p>
<ul>
<li>Jacobi method</li>
<li>Gauss-Seidel method</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Jacobi-method">Jacobi method<a class="anchor-link" href="#Jacobi-method"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-matlab"><pre><span></span><span class="c">%%file heat_equation_jacobi.m</span>
<span class="k">function</span><span class="w"> </span>[time, num_point, num_iter] <span class="p">=</span><span class="w"> </span><span class="nf">heat_equation_jacobi</span><span class="p">(</span>h<span class="p">)</span><span class="w"></span>

<span class="n">x</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">h</span> <span class="p">:</span> <span class="mi">1</span><span class="p">];</span> <span class="n">n</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="n">y</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">h</span> <span class="p">:</span> <span class="mi">1</span><span class="p">];</span> <span class="n">m</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>

<span class="c">% The coefficient matrix A is now m*n by m*n, since that is the total number of points.</span>
<span class="c">% The right-hand side vector b is m*n by 1.</span>
<span class="n">A</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">);</span>
<span class="n">b</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">num_point</span> <span class="p">=</span> <span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">;</span>

<span class="n">tic</span><span class="p">;</span>

<span class="n">u_left</span> <span class="p">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="n">u_right</span> <span class="p">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="n">u_bottom</span> <span class="p">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="n">u_top</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c">% initial guess</span>
<span class="n">u</span> <span class="p">=</span> <span class="mi">100</span><span class="o">*</span><span class="nb">ones</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="c">% dummy value for residual variable</span>
<span class="n">epsilon</span> <span class="p">=</span> <span class="mf">1.0</span><span class="p">;</span> 

<span class="n">num_iter</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">while</span> <span class="n">epsilon</span> <span class="o">&gt;</span> <span class="mf">1e-6</span>
    <span class="n">u_old</span> <span class="p">=</span> <span class="n">u</span><span class="p">;</span>
    
    <span class="n">epsilon</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="nb">j</span> <span class="p">=</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">m</span>
        <span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">n</span>
            <span class="n">kij</span> <span class="p">=</span> <span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span><span class="p">;</span>
            <span class="n">kim1j</span> <span class="p">=</span> <span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">kip1j</span> <span class="p">=</span> <span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">kijm1</span> <span class="p">=</span> <span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span><span class="p">;</span>
            <span class="n">kijp1</span> <span class="p">=</span> <span class="nb">j</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span><span class="p">;</span>

            <span class="k">if</span> <span class="nb">i</span> <span class="o">==</span> <span class="mi">1</span> 
                <span class="c">% this is the left boundary</span>
                <span class="n">u</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="n">u_left</span><span class="p">;</span>
            <span class="k">elseif</span> <span class="nb">i</span> <span class="o">==</span> <span class="n">n</span> 
                <span class="c">% right boundary</span>
                <span class="n">u</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="n">u_right</span><span class="p">;</span>
            <span class="k">elseif</span> <span class="nb">j</span> <span class="o">==</span> <span class="mi">1</span> 
                <span class="c">% bottom boundary</span>
                <span class="n">u</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="n">u_bottom</span><span class="p">;</span>
            <span class="k">elseif</span> <span class="nb">j</span> <span class="o">==</span> <span class="n">m</span> 
                <span class="c">% top boundary</span>
                <span class="n">u</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="n">u_top</span><span class="p">;</span>
            <span class="k">else</span>
                <span class="c">% interior points</span>
                <span class="n">u</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="p">(</span><span class="n">u_old</span><span class="p">(</span><span class="n">kip1j</span><span class="p">)</span> <span class="o">+</span> <span class="n">u_old</span><span class="p">(</span><span class="n">kim1j</span><span class="p">)</span> <span class="o">+</span> <span class="n">u_old</span><span class="p">(</span><span class="n">kijm1</span><span class="p">)</span> <span class="o">+</span> <span class="n">u_old</span><span class="p">(</span><span class="n">kijp1</span><span class="p">))</span><span class="o">/</span><span class="mf">4.0</span><span class="p">;</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>
    
    <span class="n">epsilon</span> <span class="p">=</span> <span class="n">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">u_old</span><span class="p">));</span>
    <span class="n">num_iter</span> <span class="p">=</span> <span class="n">num_iter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">end</span>

<span class="n">u_square</span> <span class="p">=</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">]);</span>
<span class="c">% the &quot;20&quot; indicates the number of levels for the contour plot</span>
<span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u_square</span><span class="o">&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
<span class="n">c</span> <span class="p">=</span> <span class="n">colorbar</span><span class="p">;</span>
<span class="n">c</span><span class="p">.</span><span class="n">Label</span><span class="p">.</span><span class="n">String</span> <span class="p">=</span> <span class="s">&#39;Temperature&#39;</span><span class="p">;</span>

<span class="n">time</span> <span class="p">=</span> <span class="n">toc</span><span class="p">;</span>
<span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;Number of iterations: %d\n&#39;</span><span class="p">,</span> <span class="n">num_iter</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Created file &#39;/Users/kyle/projects/ME373-book/content/pdes/heat_equation_jacobi.m&#39;.
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-matlab"><pre><span></span><span class="n">step_sizes</span> <span class="p">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.0125</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">];</span>
<span class="n">n</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">step_sizes</span><span class="p">);</span>

<span class="n">nums_jac</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="n">times_jac</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="n">num_iter_jac</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

<span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">n</span>
    <span class="p">[</span><span class="n">times_jac</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span> <span class="n">nums_jac</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span> <span class="n">num_iter_jac</span><span class="p">(</span><span class="nb">i</span><span class="p">)]</span> <span class="p">=</span> <span class="n">heat_equation_jacobi</span><span class="p">(</span><span class="n">step_sizes</span><span class="p">(</span><span class="nb">i</span><span class="p">));</span>
<span class="k">end</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Number of iterations: 291
Number of iterations: 1061
Number of iterations: 3803
Number of iterations: 5717
Number of iterations: 13421
Number of iterations: 20067
Number of iterations: 69037
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/pdes/elliptic_21_1.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Gauss-Seidel-method">Gauss-Seidel method<a class="anchor-link" href="#Gauss-Seidel-method"> </a></h3><p>The Gauss-Seidel method essentially works by starting with an initial guess to the solution, then using the recursion formula to solve for values at each point, then repeating this until the values converge (i.e., stop changing).</p>
<p>An algorithm we can use to solve Laplace's equation:</p>
<ol>
<li>Set some initial guess for all unknowns: $u_{i,j}^{\text{old}}$</li>
<li>Set the boundary values, and set $u_{i,j} = u_{i,j}^{\text{old}}$</li>
<li>For each point in the interior, use the recursion formula to solve for new values based on surrounding points: $u_{i,j} = \left( u_{i+1,j} + u_{i-1,j} + u_{i,j+1} + u_{i,j-1} \right)/4$.</li>
<li>Check for convergence: is $\epsilon$ less than some tolerance, such as $10^{-6}$? Where $\epsilon = \max \left| u_{i,j} - u_{i,j}^{\text{old}} \right|$. If no, then return to step 2 and repeat.</li>
</ol>
<p>One important component of the Gauss-Seidel method is to immediately incorporate updated values in the solution; this contrasts the Jacobi method, which only uses old values to calculate new ones. The Gauss-Seidel generally converges faster.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-matlab"><pre><span></span><span class="c">%%file heat_equation_gaussseidel.m</span>
<span class="k">function</span><span class="w"> </span>[time, num_point, num_iter] <span class="p">=</span><span class="w"> </span><span class="nf">heat_equation_gaussseidel</span><span class="p">(</span>h<span class="p">)</span><span class="w"></span>

<span class="n">x</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">h</span> <span class="p">:</span> <span class="mi">1</span><span class="p">];</span> <span class="n">n</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="n">y</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">h</span> <span class="p">:</span> <span class="mi">1</span><span class="p">];</span> <span class="n">m</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>

<span class="c">% The coefficient matrix A is now m*n by m*n, since that is the total number of points.</span>
<span class="c">% The right-hand side vector b is m*n by 1.</span>
<span class="n">A</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">);</span>
<span class="n">b</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">num_point</span> <span class="p">=</span> <span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">;</span>

<span class="n">tic</span><span class="p">;</span>

<span class="n">u_left</span> <span class="p">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="n">u_right</span> <span class="p">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="n">u_bottom</span> <span class="p">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="n">u_top</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c">% initial guess</span>
<span class="n">u</span> <span class="p">=</span> <span class="mi">100</span><span class="o">*</span><span class="nb">ones</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="c">% dummy value for residual variable</span>
<span class="n">epsilon</span> <span class="p">=</span> <span class="mf">1.0</span><span class="p">;</span> 

<span class="n">num_iter</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">while</span> <span class="n">epsilon</span> <span class="o">&gt;</span> <span class="mf">1e-6</span>
    <span class="n">u_old</span> <span class="p">=</span> <span class="n">u</span><span class="p">;</span>
    
    <span class="n">epsilon</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="nb">j</span> <span class="p">=</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">m</span>
        <span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">n</span>
            <span class="n">kij</span> <span class="p">=</span> <span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span><span class="p">;</span>
            <span class="n">kim1j</span> <span class="p">=</span> <span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">kip1j</span> <span class="p">=</span> <span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">kijm1</span> <span class="p">=</span> <span class="p">(</span><span class="nb">j</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span><span class="p">;</span>
            <span class="n">kijp1</span> <span class="p">=</span> <span class="nb">j</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="nb">i</span><span class="p">;</span>

            <span class="k">if</span> <span class="nb">i</span> <span class="o">==</span> <span class="mi">1</span> 
                <span class="c">% this is the left boundary</span>
                <span class="n">u</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="n">u_left</span><span class="p">;</span>
            <span class="k">elseif</span> <span class="nb">i</span> <span class="o">==</span> <span class="n">n</span> 
                <span class="c">% right boundary</span>
                <span class="n">u</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="n">u_right</span><span class="p">;</span>
            <span class="k">elseif</span> <span class="nb">j</span> <span class="o">==</span> <span class="mi">1</span> 
                <span class="c">% bottom boundary</span>
                <span class="n">u</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="n">u_bottom</span><span class="p">;</span>
            <span class="k">elseif</span> <span class="nb">j</span> <span class="o">==</span> <span class="n">m</span> 
                <span class="c">% top boundary</span>
                <span class="n">u</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="n">u_top</span><span class="p">;</span>
            <span class="k">else</span>
                <span class="c">% interior points</span>
                <span class="n">u</span><span class="p">(</span><span class="n">kij</span><span class="p">)</span> <span class="p">=</span> <span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="n">kip1j</span><span class="p">)</span> <span class="o">+</span> <span class="n">u</span><span class="p">(</span><span class="n">kim1j</span><span class="p">)</span> <span class="o">+</span> <span class="n">u</span><span class="p">(</span><span class="n">kijm1</span><span class="p">)</span> <span class="o">+</span> <span class="n">u</span><span class="p">(</span><span class="n">kijp1</span><span class="p">))</span><span class="o">/</span><span class="mf">4.0</span><span class="p">;</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>
    
    <span class="n">epsilon</span> <span class="p">=</span> <span class="n">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">u_old</span><span class="p">));</span>
    <span class="n">num_iter</span> <span class="p">=</span> <span class="n">num_iter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">end</span>

<span class="n">u_square</span> <span class="p">=</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">]);</span>
<span class="c">%% the &quot;20&quot; indicates the number of levels for the contour plot</span>
<span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u_square</span><span class="o">&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
<span class="n">c</span> <span class="p">=</span> <span class="n">colorbar</span><span class="p">;</span>
<span class="n">c</span><span class="p">.</span><span class="n">Label</span><span class="p">.</span><span class="n">String</span> <span class="p">=</span> <span class="s">&#39;Temperature&#39;</span><span class="p">;</span>

<span class="n">time</span> <span class="p">=</span> <span class="n">toc</span><span class="p">;</span>
<span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;Number of iterations: %d\n&#39;</span><span class="p">,</span> <span class="n">num_iter</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Created file &#39;/Users/kyle/projects/ME373-book/content/pdes/heat_equation_gaussseidel.m&#39;.
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-matlab"><pre><span></span><span class="n">step_sizes</span> <span class="p">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.0125</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">];</span>
<span class="n">n</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">step_sizes</span><span class="p">);</span>

<span class="n">nums_gs</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="n">times_gs</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="n">num_iter_gs</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

<span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">n</span>
    <span class="p">[</span><span class="n">times_gs</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span> <span class="n">nums_gs</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span> <span class="n">num_iter_gs</span><span class="p">(</span><span class="nb">i</span><span class="p">)]</span> <span class="p">=</span> <span class="n">heat_equation_gaussseidel</span><span class="p">(</span><span class="n">step_sizes</span><span class="p">(</span><span class="nb">i</span><span class="p">));</span>
<span class="k">end</span>

<span class="n">loglog</span><span class="p">(</span><span class="n">nums</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="s">&#39;-o&#39;</span><span class="p">);</span> <span class="n">hold</span> <span class="n">on</span>
<span class="n">loglog</span><span class="p">(</span><span class="n">nums_jac</span><span class="p">,</span> <span class="n">times_jac</span><span class="p">,</span> <span class="s">&#39;-^&#39;</span><span class="p">)</span>
<span class="n">loglog</span><span class="p">(</span><span class="n">nums_gs</span><span class="p">,</span> <span class="n">times_gs</span><span class="p">,</span> <span class="s">&#39;-x&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Number of unknowns&#39;</span><span class="p">);</span> 
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Time for solution (sec)&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">(</span><span class="s">&#39;Direct solution&#39;</span><span class="p">,</span> <span class="s">&#39;Jacobi solution&#39;</span><span class="p">,</span> <span class="s">&#39;Gauss-Seidel solution&#39;</span><span class="p">,</span> <span class="s">&#39;Location&#39;</span><span class="p">,</span> <span class="s">&#39;northwest&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Number of iterations: 156
Number of iterations: 564
Number of iterations: 2025
Number of iterations: 3048
Number of iterations: 7181
Number of iterations: 10762
Number of iterations: 37378
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/pdes/elliptic_24_1.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-matlab"><pre><span></span><span class="n">loglog</span><span class="p">(</span><span class="n">nums_jac</span><span class="p">,</span> <span class="n">num_iter_jac</span><span class="p">,</span> <span class="s">&#39;-^&#39;</span><span class="p">)</span>
<span class="n">hold</span> <span class="n">on</span><span class="p">;</span>
<span class="n">loglog</span><span class="p">(</span><span class="n">nums_gs</span><span class="p">,</span> <span class="n">num_iter_gs</span><span class="p">,</span> <span class="s">&#39;-x&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Number of unknowns&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Number of iterations required&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">(</span><span class="s">&#39;Jacobi method&#39;</span><span class="p">,</span> <span class="s">&#39;Gauss-Seidel method&#39;</span><span class="p">,</span> <span class="s">&#39;Location&#39;</span><span class="p">,</span> <span class="s">&#39;northwest&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/pdes/elliptic_25_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These results show us a few things:</p>
<ul>
<li>For very small problems, the direct solution method is faster.</li>
<li>For the heat equation, once we get to around 1000 unknowns, the methods perform similarly. Beyond this, the direct solution method becomes unreasonably slow, and even fails to solve in a reasonable time for a step size of 0.005.</li>
<li>The Gauss-Seidel method converges with around half the number of iterations than the Jacobi method.</li>
</ul>
<p>For larger, more-realistic problems, iterative solution methods like Jacobi and Gauss-Seidel are essential.</p>

</div>
</div>
</div>
</div>

 


    </main>
    